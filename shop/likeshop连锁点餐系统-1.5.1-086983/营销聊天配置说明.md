# 营销聊天页面 - 后台配置说明

## 功能说明

营销聊天页面现在支持在后台配置所有内容，包括：
- 聊天对话流程
- 问题和答案选项
- 顶部横幅文案
- 底部备案信息
- 客服头像

## 配置方式

### 方式一：通过数据库配置

在数据库的配置表中添加以下配置项：

**表名**: `la_config` （具体表名根据你的系统前缀而定）

#### 1. 聊天流程配置

```sql
-- 配置键名: marketing_chat.chat_flow
-- 配置值为 JSON 格式
INSERT INTO `la_config` (`type`, `name`, `value`) VALUES 
('marketing_chat', 'chat_flow', '[
  {
    "type": "service",
    "content": "我们是做全行业获客的专业团队，能够帮助您精准获取客户；意向客户会主动添加您，全行业均可做；若您有需求，请认真回答以下问题。",
    "delay": 500
  },
  {
    "type": "service",
    "content": "您是否整面临获客难、成本高的问题？",
    "delay": 1000,
    "waitForResponse": true,
    "responseKey": "hasCustomerProblem",
    "buttons": [
      {"text": "是", "value": true},
      {"text": "否", "value": false}
    ]
  },
  {
    "type": "service",
    "content": "您想要获取哪里的客户？",
    "delay": 800,
    "waitForResponse": true,
    "responseKey": "customerLocation",
    "buttons": [
      {"text": "本地客户", "value": "local"},
      {"text": "全国客户", "value": "national"}
    ]
  },
  {
    "type": "service",
    "content": "我们提供精准客户，您是否接受1000-3000/年的合作费用？",
    "delay": 800,
    "waitForResponse": true,
    "responseKey": "acceptPrice",
    "buttons": [
      {"text": "是", "value": true, "type": "primary"},
      {"text": "否", "value": false, "type": "warning"}
    ]
  },
  {
    "type": "service",
    "content": "太棒了！请留下您的联系方式，我们的专业顾问将在24小时内与您联系。",
    "delay": 800,
    "condition": {"key": "acceptPrice", "value": true}
  },
  {
    "type": "service",
    "content": "感谢您的关注！如果以后有需要，随时欢迎咨询我们。",
    "delay": 800,
    "condition": {"key": "acceptPrice", "value": false}
  }
]');
```

#### 2. 其他配置项

```sql
-- 顶部横幅标题
INSERT INTO `la_config` (`type`, `name`, `value`) VALUES 
('marketing_chat', 'banner_title', '我们帮您把业务/产品推广出去');

-- 顶部横幅副标题
INSERT INTO `la_config` (`type`, `name`, `value`) VALUES 
('marketing_chat', 'banner_subtitle', '您只需要等着客户主动找上门');

-- 底部备案信息
INSERT INTO `la_config` (`type`, `name`, `value`) VALUES 
('marketing_chat', 'footer_text', '页面信息及服务由湖北客聚多企业管理有限公司提供');

-- 客服头像（上传图片后的路径）
INSERT INTO `la_config` (`type`, `name`, `value`) VALUES 
('marketing_chat', 'service_avatar', '/uploads/images/service_avatar.png');
```

### 方式二：通过后台管理界面配置

如果你想创建一个后台管理页面，需要在后台管理系统中添加配置模块：

#### 创建后台控制器（可选）

路径: `server/app/admin/controller/MarketingChat.php`

```php
<?php
namespace app\admin\controller;

use app\common\basics\Admin;
use app\common\server\ConfigServer;
use app\common\server\JsonServer;

class MarketingChat extends Admin
{
    /**
     * 获取营销聊天配置
     */
    public function getConfig()
    {
        $config = [
            'chat_flow' => ConfigServer::get('marketing_chat', 'chat_flow', ''),
            'banner_title' => ConfigServer::get('marketing_chat', 'banner_title', ''),
            'banner_subtitle' => ConfigServer::get('marketing_chat', 'banner_subtitle', ''),
            'footer_text' => ConfigServer::get('marketing_chat', 'footer_text', ''),
            'service_avatar' => ConfigServer::get('marketing_chat', 'service_avatar', ''),
        ];
        return JsonServer::success('获取成功', $config);
    }

    /**
     * 保存营销聊天配置
     */
    public function saveConfig()
    {
        $post = $this->request->post();
        
        if (isset($post['chat_flow'])) {
            ConfigServer::set('marketing_chat', 'chat_flow', json_encode($post['chat_flow']));
        }
        if (isset($post['banner_title'])) {
            ConfigServer::set('marketing_chat', 'banner_title', $post['banner_title']);
        }
        if (isset($post['banner_subtitle'])) {
            ConfigServer::set('marketing_chat', 'banner_subtitle', $post['banner_subtitle']);
        }
        if (isset($post['footer_text'])) {
            ConfigServer::set('marketing_chat', 'footer_text', $post['footer_text']);
        }
        if (isset($post['service_avatar'])) {
            ConfigServer::set('marketing_chat', 'service_avatar', $post['service_avatar']);
        }

        return JsonServer::success('保存成功');
    }
}
```

## 聊天流程配置说明

### 消息对象结构

每个消息对象包含以下字段：

```json
{
  "type": "service",           // 消息类型: "service" 客服消息, "user" 用户消息
  "content": "消息内容",        // 必填：显示的文本内容
  "delay": 500,                // 可选：消息显示前的延迟(毫秒)
  "waitForResponse": true,     // 可选：是否等待用户响应
  "responseKey": "问题标识",    // 可选：用于存储用户回答的键名
  "buttons": [],               // 可选：按钮选项数组
  "condition": {}              // 可选：条件显示（基于之前的回答）
}
```

### 按钮对象结构

```json
{
  "text": "按钮文字",          // 必填：按钮显示文本
  "value": true,             // 必填：按钮的值
  "type": "primary"          // 可选：按钮样式 "primary"黄色, "warning"橙色
}
```

### 条件对象结构

```json
{
  "key": "acceptPrice",      // 必填：要检查的回答键名
  "value": true              // 必填：期望的值
}
```

### 示例：创建一个简单的对话流程

```json
[
  {
    "type": "service",
    "content": "您好！欢迎咨询我们的服务",
    "delay": 500
  },
  {
    "type": "service",
    "content": "请问您对哪种服务感兴趣？",
    "delay": 800,
    "waitForResponse": true,
    "responseKey": "serviceType",
    "buttons": [
      {"text": "产品推广", "value": "promotion"},
      {"text": "技术支持", "value": "support"},
      {"text": "其他咨询", "value": "other"}
    ]
  },
  {
    "type": "service",
    "content": "您选择了产品推广服务，我们将为您提供专业方案。",
    "delay": 800,
    "condition": {"key": "serviceType", "value": "promotion"}
  },
  {
    "type": "service",
    "content": "您选择了技术支持，我们的工程师将协助您。",
    "delay": 800,
    "condition": {"key": "serviceType", "value": "support"}
  }
]
```

## 测试配置

配置完成后：

1. 前端访问 `/pages/marketing_chat/marketing_chat` 页面
2. 检查是否正确加载了配置的内容
3. 测试对话流程是否按预期工作
4. 验证条件分支逻辑

## 常见问题

### Q: 如何修改聊天内容？
A: 修改数据库中 `marketing_chat.chat_flow` 配置项的 JSON 内容即可。

### Q: 如何添加更多问题？
A: 在 `chat_flow` 数组中添加更多消息对象。

### Q: 如何实现复杂的分支逻辑？
A: 使用 `condition` 字段，根据用户之前的回答显示不同的消息。

### Q: 如何更换客服头像？
A: 上传图片到服务器，然后修改 `marketing_chat.service_avatar` 配置项。

## 注意事项

1. JSON 格式必须正确，否则会使用默认配置
2. `responseKey` 必须唯一，用于追踪用户的回答
3. 条件检查会精确匹配 value 值
4. delay 时间不要设置过长，影响用户体验
5. 按钮文字要简洁明了

## 技术支持

如需帮助，请联系技术支持团队。
