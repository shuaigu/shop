# 营销聊天后台管理页面 - 使用指南

## 📦 已创建的文件

1. **后端控制器**
   - 路径：`server/app/admin/controller/MarketingChat.php`
   - 功能：处理配置的获取和保存

2. **前端页面**
   - 路径：`server/app/admin/view/marketing_chat/index.html`
   - 功能：可视化配置界面

## 🚀 快速开始

### 方法一：直接访问URL（最快）

在浏览器中访问：
```
http://你的域名/admin/marketing_chat/index
```

例如：
```
http://localhost/admin/marketing_chat/index
http://shop.example.com/admin/marketing_chat/index
```

### 方法二：添加到后台菜单

#### 步骤1：登录后台数据库

找到权限表（通常是 `la_auth` 或类似名称）

#### 步骤2：插入菜单权限

```sql
-- 查看现有菜单结构
SELECT id, pid, name, uri FROM la_auth WHERE name LIKE '%设置%' OR name LIKE '%营销%';

-- 假设找到"设置"菜单的ID是100，插入子菜单
INSERT INTO `la_auth` (`pid`, `name`, `uri`, `type`, `sort`, `is_show`) 
VALUES (100, '营销聊天配置', 'marketing_chat/index', 1, 100, 1);

-- 如果要作为一级菜单
INSERT INTO `la_auth` (`pid`, `name`, `uri`, `type`, `sort`, `is_show`) 
VALUES (0, '营销聊天配置', 'marketing_chat/index', 1, 100, 1);
```

#### 步骤3：刷新后台

退出后台重新登录，或者清除缓存，就能在菜单中看到"营销聊天配置"了。

### 方法三：通过后台界面添加菜单

1. 登录后台管理系统
2. 找到"权限管理" → "菜单管理"
3. 点击"添加菜单"
4. 填写以下信息：
   - 菜单名称：营销聊天配置
   - 上级菜单：选择"设置"或其他合适的菜单
   - 路由地址：`marketing_chat/index`
   - 排序：100
   - 是否显示：是
5. 保存后刷新页面

## 💡 使用功能

### 1. 基础设置标签页

配置页面的基本信息：

- **横幅标题** - 页面顶部的主标题
- **横幅副标题** - 页面顶部的副标题
- **底部信息** - 页面底部的公司信息
- **客服头像** - 点击上传客服头像图片

点击"保存基础设置"按钮保存修改。

### 2. 对话流程（可视化）标签页

可视化编辑对话流程：

#### 添加消息
1. 点击"添加消息"按钮
2. 填写消息内容
3. 设置延迟时间（毫秒）
4. 选择是否等待用户响应

#### 配置交互按钮
1. 开启"等待响应"开关
2. 填写"响应键名"（用于标识这个问题）
3. 点击"添加按钮"添加选项
4. 填写按钮文字和值
5. 选择按钮样式（默认/主要/警告）

#### 调整顺序
- 点击 ⬆ 按钮上移消息
- 点击 ⬇ 按钮下移消息
- 点击 🗑 按钮删除消息

点击"保存对话流程"按钮保存修改。

### 3. 对话流程（JSON）标签页

适合高级用户直接编辑JSON：

- **格式化** - 美化JSON格式
- **验证** - 检查JSON语法是否正确
- **保存JSON配置** - 直接保存JSON内容

## 📝 配置示例

### 简单的三个问题对话

```json
[
  {
    "type": "service",
    "content": "您好，欢迎咨询！",
    "delay": 500
  },
  {
    "type": "service",
    "content": "您对什么感兴趣？",
    "delay": 800,
    "waitForResponse": true,
    "responseKey": "interest",
    "buttons": [
      {"text": "产品A", "value": "A"},
      {"text": "产品B", "value": "B"}
    ]
  },
  {
    "type": "service",
    "content": "感谢您的咨询！",
    "delay": 800
  }
]
```

### 带条件分支的对话

```json
[
  {
    "type": "service",
    "content": "您需要什么服务？",
    "delay": 500,
    "waitForResponse": true,
    "responseKey": "serviceType",
    "buttons": [
      {"text": "咨询", "value": "consult"},
      {"text": "购买", "value": "buy"}
    ]
  },
  {
    "type": "service",
    "content": "我们的客服将为您详细解答。",
    "delay": 800,
    "condition": {"key": "serviceType", "value": "consult"}
  },
  {
    "type": "service",
    "content": "请选择您要购买的产品。",
    "delay": 800,
    "condition": {"key": "serviceType", "value": "buy"}
  }
]
```

## 🔧 常见问题

### Q1: 访问页面显示404

**解决方案：**
1. 检查文件路径是否正确
2. 检查服务器伪静态配置
3. 尝试清除后台缓存：后台 → 系统 → 系统缓存 → 清除缓存

### Q2: 保存后前端没有更新

**解决方案：**
1. 前端小程序/H5需要刷新页面
2. 检查浏览器缓存
3. 重新编译小程序

### Q3: 上传图片失败

**解决方案：**
1. 检查上传目录权限
2. 检查图片大小是否超限
3. 查看后台上传配置

### Q4: JSON格式错误

**解决方案：**
1. 点击"验证"按钮查看具体错误
2. 确保使用双引号，不要用单引号
3. 检查括号、逗号是否配对
4. 使用在线JSON验证工具：https://jsonlint.com/

## 📱 测试配置

保存配置后，可以通过以下方式测试：

1. **小程序端**
   - 在小程序中访问：`/pages/marketing_chat/marketing_chat`
   - 或从个人中心点击"在线咨询"

2. **H5端**
   - 在浏览器中访问对应页面
   - 下拉刷新查看最新配置

3. **预览功能**
   - 在后台点击"预览"按钮（如果实现）
   - 或者生成二维码扫描查看

## 🎯 最佳实践

1. **消息数量** - 建议不超过10条，避免用户疲劳
2. **延迟时间** - 一般设置500-1000毫秒，模拟真实聊天
3. **按钮数量** - 每个问题不超过4个选项
4. **文案长度** - 每条消息不超过100字
5. **分支逻辑** - 不要太复杂，最多3层分支

## 📞 技术支持

如遇到问题，请：
1. 查看服务器错误日志
2. 查看浏览器控制台
3. 联系技术支持团队

---

**配置完成后记得测试！** ✅
