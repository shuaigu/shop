-- =====================================================
-- 在红框位置添加营销聊天菜单（独立一级菜单）
-- =====================================================
-- 使用说明：
-- 1. 这个SQL会在菜单底部添加"营销聊天"菜单
-- 2. 执行前请先查看你的表名和字段
-- 3. 根据实际情况调整表前缀（默认 la_）
-- =====================================================

-- 第一步：查看现有菜单结构，确认最大的sort值
SELECT id, pid, name, uri, sort FROM `la_auth` 
WHERE pid = 0 
ORDER BY sort DESC 
LIMIT 10;

-- 第二步：添加营销聊天菜单到底部
-- sort值设为999，确保显示在最下方
INSERT INTO `la_auth` (
    `pid`, 
    `name`, 
    `uri`, 
    `type`, 
    `sort`, 
    `is_show`, 
    `icon`,
    `create_time`, 
    `update_time`
) VALUES (
    0,                          -- pid=0 表示一级菜单
    '营销聊天',                  -- 菜单名称
    'marketing_chat/index',     -- 路由地址
    1,                          -- type=1 表示菜单
    999,                        -- sort=999 显示在底部
    1,                          -- is_show=1 显示
    'el-icon-chat-dot-square',  -- 图标（如果系统支持）
    UNIX_TIMESTAMP(),           -- 创建时间
    UNIX_TIMESTAMP()            -- 更新时间
);

-- 第三步：查看添加结果
SELECT id, pid, name, uri, sort, is_show 
FROM `la_auth` 
WHERE name = '营销聊天';

-- =====================================================
-- 如果需要添加子菜单（可选）
-- =====================================================

-- 先获取刚添加的菜单ID
SET @parent_id = (SELECT id FROM `la_auth` WHERE name = '营销聊天' AND pid = 0 LIMIT 1);

-- 添加子菜单：配置管理
INSERT INTO `la_auth` (
    `pid`, 
    `name`, 
    `uri`, 
    `type`, 
    `sort`, 
    `is_show`,
    `create_time`, 
    `update_time`
) VALUES (
    @parent_id,                  -- 父级菜单ID
    '配置管理',                   -- 子菜单名称
    'marketing_chat/index',      -- 路由地址
    1,                           -- type=1 表示菜单
    1,                           -- 排序
    1,                           -- 显示
    UNIX_TIMESTAMP(),            -- 创建时间
    UNIX_TIMESTAMP()             -- 更新时间
);

-- =====================================================
-- 查看完整菜单结构
-- =====================================================

-- 查看所有一级菜单（按排序）
SELECT id, name, uri, sort, is_show 
FROM `la_auth` 
WHERE pid = 0 
ORDER BY sort;

-- =====================================================
-- 如果需要调整位置
-- =====================================================

-- 如果想放在"个人"菜单后面，先找到"个人"菜单的sort值
SELECT id, name, sort FROM `la_auth` WHERE name LIKE '%个人%' AND pid = 0;

-- 假设"个人"菜单的sort是800，那么设置营销聊天为801
-- UPDATE `la_auth` SET sort = 801 WHERE name = '营销聊天' AND pid = 0;

-- =====================================================
-- 配置权限（如果系统有角色权限）
-- =====================================================

-- 给管理员角色（ID=1）添加权限
SET @menu_id = (SELECT id FROM `la_auth` WHERE name = '营销聊天' AND pid = 0 LIMIT 1);

-- 如果有角色权限表，添加权限
-- INSERT INTO `la_role_auth` (`role_id`, `auth_id`) VALUES (1, @menu_id);

-- =====================================================
-- 删除菜单（如果添加错误，使用此命令删除重来）
-- =====================================================

-- DELETE FROM `la_auth` WHERE name = '营销聊天';

-- =====================================================
-- 完成！
-- =====================================================
-- 执行完成后：
-- 1. 清除后台缓存
-- 2. 退出后台重新登录
-- 3. 应该能在左侧菜单底部看到"营销聊天"菜单
-- =====================================================
