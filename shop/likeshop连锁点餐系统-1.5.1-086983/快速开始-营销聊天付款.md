# 快速开始 - 营销聊天付款功能

## 🚀 三步完成部署

### 第一步：创建数据库表（2分钟）

在数据库管理工具（如phpMyAdmin、Navicat）中执行 `营销聊天订单表.sql` 文件。

**方法1：命令行**
```bash
mysql -u用户名 -p密码 数据库名 < 营销聊天订单表.sql
```

**方法2：图形化工具**
- 打开 `营销聊天订单表.sql`
- 复制全部内容
- 在数据库管理工具中执行

### 第二步：配置对话流程（3分钟）

1. 访问后台管理页面：`http://你的域名/admin/marketing_chat/index`
2. 复制 `营销聊天配置-带支付示例.json` 文件中的内容
3. 粘贴到"对话流程配置"文本框
4. 点击"格式化JSON"检查格式
5. 点击"保存对话流程"

### 第三步：测试支付功能（5分钟）

**小程序测试：**
1. 打开小程序
2. 进入营销聊天页面
3. 按照对话流程操作
4. 点击"立即支付 ¥0.40"
5. 完成支付

**H5测试：**
1. 浏览器打开H5页面
2. 进入营销聊天页面
3. 点击"立即支付"会显示模拟支付弹窗
4. 点击"模拟支付成功"测试支付流程

---

## 📝 自定义支付金额

修改JSON中的 `amount` 字段即可：

```json
{
    "text": "立即支付 ¥0.40",
    "value": "pay",
    "type": "payment",
    "amount": 0.4    ← 修改这里的金额（单位：元）
}
```

**示例：**
- 支付1元：`"amount": 1`
- 支付9.9元：`"amount": 9.9`
- 支付99元：`"amount": 99`

---

## ✅ 验证是否部署成功

### 检查清单：

- [ ] 数据库中存在 `la_marketing_chat_order` 表
- [ ] 后台可以正常保存对话流程配置
- [ ] 前端对话流程中能看到付款按钮
- [ ] 点击付款按钮能调起支付界面
- [ ] 支付成功后对话继续进行

### 查看订单记录：

在数据库中查询：
```sql
SELECT * FROM la_marketing_chat_order ORDER BY create_time DESC LIMIT 10;
```

---

## 🎨 按钮样式说明

按钮 `type` 字段控制样式：

| type 值 | 样式 | 适用场景 |
|---------|------|---------|
| `payment` | 灰色边框 | **支付按钮（必须）** |
| `primary` | 橙色背景 | 强调的主要选项 |
| `warning` | 黄色背景 | 次要或取消选项 |
| 不设置 | 灰色边框 | 普通选项 |

**示例：**
```json
{
    "text": "立即支付 ¥0.40",
    "value": "pay",
    "type": "payment",  ← 支付按钮必须设置为 payment
    "amount": 0.4
}
```

---

## 🔧 常见问题速查

### Q: 点击支付没反应？
**检查步骤：**
1. 打开浏览器控制台（F12）查看错误
2. 确认用户已登录
3. 确认数据库表已创建
4. 确认 `type: "payment"` 和 `amount` 字段已设置

### Q: 支付后订单未更新？
**检查步骤：**
1. 查看数据库 `la_marketing_chat_order` 表，订单是否创建成功
2. 检查 `pay_status` 字段：0=未支付，1=已支付
3. 查看后端日志：`server/runtime/log/`

### Q: 微信支付提示授权失效？
**解决方法：**
退出小程序，重新进入并授权登录

---

## 📱 示例效果

用户看到的对话流程：

```
🤖 我们是做全行业获客的专业团队...
   [是] [否]

👤 是

🤖 您想要获取哪里的客户？
   [本地客户] [全国客户]

👤 本地客户

🤖 为了确认您的诚意，请先支付0.4元诚意金（可抵扣后续费用）
   [立即支付 ¥0.40] [暂不支付]

👤 立即支付 ¥0.40
   📱 调起微信支付...

🤖 ✓ 支付成功！感谢您的信任。

🤖 我们提供精准客户，您是否接受1000-3000/年的合作费用？
   [是] [否]
```

---

## 🎯 进阶功能

### 1. 多个付款节点

可以在对话流程的不同位置设置多个付款按钮：

```json
[
    { "content": "第一次付款0.1元验证诚意", "buttons": [{"type": "payment", "amount": 0.1}] },
    ...更多对话...
    { "content": "第二次付款9.9元获取资料", "buttons": [{"type": "payment", "amount": 9.9}] }
]
```

### 2. 根据支付状态分流

```json
{
    "content": "VIP客户专属服务",
    "condition": {
        "key": "paymentConfirm",
        "value": "paid"
    }
}
```

### 3. 不同金额选项

```json
{
    "buttons": [
        {"text": "体验版 ¥0.40", "type": "payment", "amount": 0.4},
        {"text": "标准版 ¥9.90", "type": "payment", "amount": 9.9},
        {"text": "高级版 ¥99.00", "type": "payment", "amount": 99}
    ]
}
```

---

## 📞 获取帮助

- 查看详细文档：`营销聊天付款功能-部署说明.md`
- 查看示例配置：`营销聊天配置-带支付示例.json`
- 查看代码注释：`uniapp/pages/marketing_chat/marketing_chat.vue`

---

**🎉 祝您使用愉快！**
