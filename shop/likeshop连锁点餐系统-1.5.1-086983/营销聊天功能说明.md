# 营销聊天功能 - 完整说明

## 📋 功能概述

这是一个可在后台完全配置的聊天式营销页面，类似于微信聊天界面，支持：

✅ **后台配置对话流程** - 无需修改代码
✅ **条件分支逻辑** - 根据用户回答显示不同内容
✅ **多选项按钮** - 支持按钮式交互
✅ **自定义样式** - 横幅、头像、底部信息等
✅ **打字动画效果** - 真实的聊天体验

## 🚀 快速开始

### 1. 导入数据库配置

在数据库中执行 `营销聊天配置.sql` 文件：

```bash
mysql -u用户名 -p密码 数据库名 < 营销聊天配置.sql
```

或者在phpMyAdmin中导入该SQL文件。

### 2. 访问页面

前端访问路径：`/pages/marketing_chat/marketing_chat`

### 3. 入口位置

目前已在以下位置添加了入口：
- **个人中心页面** - "我的服务"区域的"在线咨询"按钮

## 📁 文件结构

```
项目根目录/
├── uniapp/
│   ├── pages/
│   │   └── marketing_chat/
│   │       └── marketing_chat.vue           # 前端页面
│   └── api/
│       └── store.js                         # API接口（已添加）
├── server/
│   └── app/
│       └── api/
│           └── controller/
│               └── Setting.php              # 后端接口（已添加）
├── 营销聊天配置.sql                         # 数据库配置文件
├── 营销聊天配置说明.md                      # 详细配置文档
├── 后台配置示例-Vue页面.vue                 # 后台管理页面示例
└── 营销聊天功能说明.md                      # 本文件
```

## ⚙️ 配置方法

### 方法一：直接修改数据库（推荐新手）

1. 找到数据库中的 `la_config` 表（根据你的表前缀可能不同）
2. 找到 `type = 'marketing_chat'` 的记录
3. 修改对应的 `value` 字段

**主要配置项：**
- `banner_title` - 横幅标题
- `banner_subtitle` - 横幅副标题
- `footer_text` - 底部信息
- `service_avatar` - 客服头像URL
- `chat_flow` - 对话流程（JSON格式）

### 方法二：使用后台管理界面（推荐）

1. 参考 `后台配置示例-Vue页面.vue` 创建后台管理页面
2. 在后台管理系统中添加"营销聊天配置"菜单
3. 通过可视化界面配置所有内容

### 方法三：通过API接口

```javascript
// 获取配置
GET /api/setting/getMarketingChatConfig

// 保存配置（需要创建后台接口）
POST /admin/marketing_chat/saveConfig
```

## 📝 对话流程配置详解

### 基本消息格式

```json
{
  "type": "service",           // "service"客服 或 "user"用户
  "content": "消息内容",
  "delay": 500,                // 延迟显示(毫秒)
  "waitForResponse": true,     // 是否等待用户回复
  "responseKey": "question1",  // 存储回答的键名
  "buttons": [],               // 按钮选项
  "condition": {}              // 条件显示
}
```

### 完整示例

```json
[
  {
    "type": "service",
    "content": "您好，欢迎咨询！",
    "delay": 500
  },
  {
    "type": "service",
    "content": "您对什么产品感兴趣？",
    "delay": 800,
    "waitForResponse": true,
    "responseKey": "productType",
    "buttons": [
      {"text": "产品A", "value": "A"},
      {"text": "产品B", "value": "B"}
    ]
  },
  {
    "type": "service",
    "content": "您选择了产品A，这是我们的明星产品！",
    "delay": 800,
    "condition": {"key": "productType", "value": "A"}
  }
]
```

## 🎨 样式自定义

### 修改主题色

在 `marketing_chat.vue` 中修改样式：

```scss
// 横幅渐变色
.header-banner {
    background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 50%, #03a9f4 100%);
}

// 按钮颜色
.option-btn.primary {
    background: #ff9800; // 修改为你喜欢的颜色
}
```

### 修改头像

上传头像图片到服务器，然后更新配置：

```sql
UPDATE `la_config` 
SET `value` = '/uploads/images/custom_avatar.png' 
WHERE `type` = 'marketing_chat' AND `name` = 'service_avatar';
```

## 🔧 常见问题

### Q1: 配置修改后前端没有更新？

**答：** 前端有缓存，尝试：
1. 清除浏览器缓存
2. 在页面中下拉刷新
3. 重新编译小程序/App

### Q2: 如何添加更多问题？

**答：** 在 `chat_flow` 数组中添加更多消息对象即可。

### Q3: 如何实现多层条件判断？

**答：** 使用不同的 `responseKey` 和 `condition` 组合：

```json
[
  {
    "type": "service",
    "content": "第一个问题",
    "waitForResponse": true,
    "responseKey": "q1",
    "buttons": [
      {"text": "是", "value": true},
      {"text": "否", "value": false}
    ]
  },
  {
    "type": "service",
    "content": "第二个问题（仅当Q1选是）",
    "waitForResponse": true,
    "responseKey": "q2",
    "condition": {"key": "q1", "value": true},
    "buttons": [...]
  },
  {
    "type": "service",
    "content": "最终消息（Q1=是 且 Q2=xxx）",
    "condition": {"key": "q2", "value": "xxx"}
  }
]
```

### Q4: JSON格式错误怎么办？

**答：** 
1. 使用在线JSON验证工具：https://jsonlint.com/
2. 确保所有引号、括号都配对
3. 注意：JSON中字符串必须用双引号，不能用单引号

### Q5: 如何收集用户信息？

**答：** 对话流程结束后，可以添加表单收集信息：

```json
{
  "type": "service",
  "content": "请留下您的联系方式，我们将尽快联系您。\n\n可以在这里添加一个表单组件。",
  "delay": 800
}
```

然后在前端页面中添加表单提交逻辑。

## 📱 访问方式

### 在其他页面跳转

```javascript
// 任意页面跳转到营销聊天页面
uni.navigateTo({
    url: '/pages/marketing_chat/marketing_chat'
})
```

### 作为独立页面

可以生成二维码或链接，直接分享给用户。

### 在首页添加入口

在首页添加一个浮动按钮或者菜单项：

```vue
<view class="chat-btn" @click="openChat">
    <image src="/static/images/icon_wechat.png"></image>
    <text>在线咨询</text>
</view>

<script>
methods: {
    openChat() {
        uni.navigateTo({
            url: '/pages/marketing_chat/marketing_chat'
        })
    }
}
</script>
```

## 🎯 应用场景

1. **产品咨询** - 引导用户了解产品特点
2. **客户筛选** - 通过问答筛选意向客户
3. **活动推广** - 互动式宣传活动信息
4. **问卷调查** - 以聊天形式收集反馈
5. **预约服务** - 引导用户预约服务

## 🔄 更新日志

### v1.0.0 (2026-01-30)
- ✅ 初始版本发布
- ✅ 支持后台配置对话流程
- ✅ 支持条件分支逻辑
- ✅ 支持按钮式交互
- ✅ 添加打字动画效果
- ✅ 在个人中心添加入口

## 📞 技术支持

如有问题或需要定制开发，请联系技术支持团队。

---

**祝您使用愉快！** 🎉
