# 砍价完成后继续显示信息 - 修改说明

## 修改日期
2026-01-28

## 修改内容

### 问题描述
砍价完成以后，砍价信息和帖子内容被隐藏，用户希望这些内容继续显示。

### 解决方案

#### 1. 修改砍价信息卡片显示条件
**文件**: `wx2/pages/article/articleDetail.vue`

**修改前**（第4234行）:
```vue
<view class="bargain-info-card" v-if="articleDetail.enable_bargain && !articleDetail.bargain_completed">
```

**修改后**:
```vue
<view class="bargain-info-card" v-if="articleDetail.enable_bargain">
```

**说明**: 移除了 `!articleDetail.bargain_completed` 条件，使砍价信息卡片在砍价完成后继续显示。

#### 2. 添加砍价完成提示横幅
在砍价信息卡片内部添加了完成状态的提示横幅，显示活动已结束及获胜者信息。

**位置**: 在倒计时显示之前添加

**代码**:
```vue
<!-- 砍价完成提示横幅 -->
<view class="bargain-completed-banner" v-if="articleDetail.bargain_completed">
  <view class="completed-icon">
    <uni-icons type="checkmarkempty" size="28" color="#52c41a"></uni-icons>
  </view>
  <view class="completed-content">
    <text class="completed-title">砍价活动已结束</text>
    <text class="completed-subtitle" v-if="articleDetail.bargain_winner_nickname">
      恭喜 {{ articleDetail.bargain_winner_nickname }} 以 ￥{{ articleDetail.bargain_buyout_price?.toFixed(2) || '0.00' }} 买断成功！
    </text>
    <text class="completed-subtitle" v-else-if="articleDetail.winner_nickname">
      恭喜 {{ articleDetail.winner_nickname }} 砍价成功！
    </text>
    <text class="completed-subtitle" v-else>活动已完成</text>
  </view>
</view>
```

#### 3. 添加样式支持
在 `.bargain-card-content` 样式下添加了 `.bargain-completed-banner` 样式：

```scss
.bargain-completed-banner {
  width: 100%;
  background: linear-gradient(135deg, #f6ffed 0%, #e6f7ff 100%);
  border-radius: 12rpx;
  padding: 24rpx;
  box-shadow: 0 2rpx 8rpx rgba(82, 196, 26, 0.12);
  border: 2rpx solid #b7eb8f;
  display: flex;
  align-items: center;
  gap: 16rpx;
  margin-bottom: 8rpx;
  
  .completed-icon {
    width: 56rpx;
    height: 56rpx;
    background: linear-gradient(135deg, #52c41a, #73d13d);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 2rpx 8rpx rgba(82, 196, 26, 0.3);
  }
  
  .completed-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6rpx;
    
    .completed-title {
      font-size: 30rpx;
      font-weight: 700;
      color: #52c41a;
      line-height: 1.4;
    }
    
    .completed-subtitle {
      font-size: 24rpx;
      color: #666;
      line-height: 1.5;
    }
  }
}
```

#### 4. 优化倒计时显示条件
修改倒计时的显示条件，使其在砍价完成后隐藏：

**修改前**:
```vue
<view class="bargain-countdown-top" v-if="articleDetail.bargain_end_time && articleDetail.bargain_end_time > 0 && !isBargainExpired">
```

**修改后**:
```vue
<view class="bargain-countdown-top" v-if="!articleDetail.bargain_completed && articleDetail.bargain_end_time && articleDetail.bargain_end_time > 0 && !isBargainExpired">
```

#### 5. 移除独立的结束提示卡片
原来的独立结束提示卡片（bargain-ended-card）已被移除，改为在砍价信息卡片内部显示完成提示。

### 最终效果

1. ✅ **砍价信息卡片**: 砍价完成后继续显示，不会被隐藏
2. ✅ **完成状态提示**: 在卡片内部显示绿色的完成横幅，提示活动已结束及获胜者信息
3. ✅ **砍价小组列表**: 继续显示所有砍价小组及其进度
4. ✅ **文章内容**: 一直保持显示（原本就没有被隐藏）
5. ✅ **图片和视频**: 一直保持显示（原本就没有被隐藏）

### 用户体验改进

- 用户可以在砍价完成后查看完整的砍价历史信息
- 清晰地看到哪个用户获胜以及买断价格
- 可以查看所有砍价小组的参与情况和进度
- 帖子内容始终可见，不会因为砍价完成而被隐藏

### 测试建议

1. 测试砍价未完成时的显示效果（倒计时正常显示）
2. 测试砍价通过买断完成后的显示效果（显示完成横幅和买断信息）
3. 测试砍价正常完成后的显示效果（显示完成横幅和获胜者信息）
4. 测试砍价小组列表在完成后是否正常显示
5. 测试文章内容（图片、视频、文字）是否一直可见

## 相关文件

- `wx2/pages/article/articleDetail.vue` - 文章详情页（主要修改文件）

## 注意事项

- 确保 `articleDetail.bargain_completed` 字段在后端正确设置
- 确保 `articleDetail.bargain_winner_nickname` 或 `articleDetail.winner_nickname` 字段包含获胜者昵称
- 确保 `articleDetail.bargain_buyout_price` 字段包含买断价格（如果是买断完成的情况）
