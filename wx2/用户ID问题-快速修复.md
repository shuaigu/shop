# ğŸ”§ ç”¨æˆ·IDé—®é¢˜ - å¿«é€Ÿä¿®å¤æŒ‡å—

## é—®é¢˜ç°è±¡

é¡µé¢æ˜¾ç¤ºçš„ç”¨æˆ·IDï¼š`67b0b5993f1a473bba2a16789`ï¼ˆç¬¬3ä½æ˜¯`b`ï¼‰  
ä½†æ•°æ®åº“ä¸­çš„_idæ˜¯ï¼š`67d0b5993f1a473bba2a16789`ï¼ˆç¬¬3ä½æ˜¯`d`ï¼‰

**IDä¸åŒ¹é…ï¼**

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ‰‹åŠ¨è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·IDï¼ˆç«‹å³å¯æµ‹è¯•ï¼‰

1. **åˆ·æ–°å°ç¨‹åº**ï¼ˆä¸éœ€è¦ä¸Šä¼ äº‘å‡½æ•°ï¼‰
2. **è¿›å…¥æµ‹è¯•é¡µé¢**
3. **åœ¨"ç”¨æˆ·ID"è¾“å…¥æ¡†ä¸­ï¼Œæ‰‹åŠ¨è¾“å…¥æ•°æ®åº“ä¸­çš„_id**ï¼š
   ```
   67d0b5993f1a473bba2a16789
   ```
   ï¼ˆä»æ•°æ®åº“æˆªå›¾å¤åˆ¶ï¼‰
4. **ç‚¹å‡»"å¼€å§‹æµ‹è¯•è½¬è´¦"**

è¿™æ ·å°±èƒ½ç«‹å³æµ‹è¯•è½¬è´¦åŠŸèƒ½äº†ï¼

---

### æ–¹æ¡ˆäºŒï¼šä¿®å¤userInfoå­˜å‚¨ï¼ˆæ ¹æœ¬è§£å†³ï¼‰

#### æ­¥éª¤1ï¼šæ£€æŸ¥userInfo

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·Consoleä¸­æ‰§è¡Œï¼š

```javascript
const userInfo = uni.getStorageSync('userInfo')
console.log('å®Œæ•´userInfo:', JSON.stringify(userInfo, null, 2))
console.log('_id:', userInfo._id)
console.log('uid:', userInfo.uid)
console.log('dcloud_appid:', userInfo.dcloud_appid)
```

#### æ­¥éª¤2ï¼šæ‰¾åˆ°æ­£ç¡®çš„æ•°æ®åº“IDå­—æ®µ

æŸ¥çœ‹è¾“å‡ºï¼Œæ‰¾åˆ°å“ªä¸ªå­—æ®µçš„å€¼æ˜¯ `67d0b5993f1a473bba2a16789`

å¯èƒ½çš„å­—æ®µï¼š
- `userInfo._id`
- `userInfo.dcloud_appid[0]`  
- æˆ–å…¶ä»–å­—æ®µ

#### æ­¥éª¤3ï¼šä¿®æ”¹æµ‹è¯•é¡µé¢

åœ¨ `testCashback.vue` ä¸­ä¿®æ”¹ï¼š

```javascript
// ä½¿ç”¨æ­£ç¡®çš„å­—æ®µ
const finalUserId = userInfo.æ­£ç¡®çš„å­—æ®µå
```

---

### æ–¹æ¡ˆä¸‰ï¼šä¸Šä¼ æ–°çš„äº‘å‡½æ•°ï¼ˆæ™ºèƒ½æŸ¥è¯¢ï¼‰

æˆ‘å·²ç»ä¿®æ”¹äº†äº‘å‡½æ•°ï¼Œæ·»åŠ äº†æ™ºèƒ½æŸ¥è¯¢é€»è¾‘ï¼š

1. **ä¸Šä¼ äº‘å‡½æ•°**
   - å³é”® `articleWx` â†’ ä¸Šä¼ éƒ¨ç½²

2. **é‡æ–°æµ‹è¯•**
   - äº‘å‡½æ•°ä¼šå°è¯•å¤šç§æ–¹å¼æŸ¥æ‰¾ç”¨æˆ·

---

## ğŸ“Š æ•°æ®åº“æŸ¥è¯¢å¯¹æ¯”

### uni-Cloud æ•°æ®åº“æŸ¥è¯¢è§„åˆ™

```javascript
// æ–¹å¼1ï¼šé€šè¿‡_idæŸ¥è¯¢ï¼ˆæœ€å¿«ï¼‰
db.collection('uni-id-users').doc('ç”¨æˆ·ID')

// æ–¹å¼2ï¼šé€šè¿‡æ¡ä»¶æŸ¥è¯¢
db.collection('uni-id-users').where({ _id: 'ç”¨æˆ·ID' })

// æ–¹å¼3ï¼šé€šè¿‡å…¶ä»–å­—æ®µæŸ¥è¯¢
db.collection('uni-id-users').where({ uid: 'å€¼' })
```

**é‡ç‚¹**ï¼š`doc(id)` æ–¹æ³•åªèƒ½é€šè¿‡ `_id` å­—æ®µæŸ¥è¯¢ï¼

---

## ğŸ” è°ƒè¯•æ­¥éª¤

### 1. ç¡®è®¤æ•°æ®åº“ä¸­çš„ç”¨æˆ·ID

åœ¨uniCloudæ§åˆ¶å° â†’ æ•°æ®åº“ â†’ uni-id-users è¡¨ä¸­ï¼š
- æ‰¾åˆ°ä½ çš„ç”¨æˆ·è®°å½•
- å¤åˆ¶ `_id` å­—æ®µçš„å€¼
- åº”è¯¥æ˜¯ï¼š`67d0b5993f1a473bba2a16789`

### 2. ç¡®è®¤userInfoä¸­çš„å¯¹åº”å­—æ®µ

```javascript
// åœ¨Consoleæ‰§è¡Œ
const userInfo = uni.getStorageSync('userInfo')
// æŸ¥æ‰¾å“ªä¸ªå­—æ®µçš„å€¼ = 67d0b5993f1a473bba2a16789
Object.keys(userInfo).forEach(key => {
  const value = userInfo[key]
  if (value === '67d0b5993f1a473bba2a16789') {
    console.log('æ‰¾åˆ°äº†ï¼å­—æ®µåæ˜¯:', key)
  }
  // å¦‚æœæ˜¯æ•°ç»„
  if (Array.isArray(value) && value.includes('67d0b5993f1a473bba2a16789')) {
    console.log('æ‰¾åˆ°äº†ï¼åœ¨æ•°ç»„å­—æ®µ:', key)
  }
})
```

### 3. æ›´æ–°æµ‹è¯•é¡µé¢

æ ¹æ®æ­¥éª¤2æ‰¾åˆ°çš„å­—æ®µåï¼Œä¿®æ”¹ä»£ç ï¼š

```vue
// å¦‚æœæ˜¯ dcloud_appid[0]
const finalUserId = userInfo.dcloud_appid?.[0] || userInfo._id || userInfo.uid

// å¦‚æœæ˜¯å…¶ä»–å­—æ®µ
const finalUserId = userInfo.æ­£ç¡®å­—æ®µå
```

---

## âœ… æ¨èæ–¹æ¡ˆ

**ç«‹å³æµ‹è¯•**ï¼šä½¿ç”¨æ–¹æ¡ˆä¸€ï¼Œæ‰‹åŠ¨è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·ID

**æ ¹æœ¬è§£å†³**ï¼š
1. ä¸Šä¼ ä¿®æ”¹åçš„äº‘å‡½æ•°ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰
2. ç„¶åä½¿ç”¨æ–¹æ¡ˆäºŒæ‰¾åˆ°æ­£ç¡®çš„å­—æ®µæ˜ å°„

---

## ğŸ“ å¸¸è§æƒ…å†µ

### æƒ…å†µ1ï¼šuni-id-users è¡¨ç»“æ„

å…¸å‹çš„å­—æ®µï¼š
```
_id: "67d0b5993f1a473bba2a16789"  â† æ•°æ®åº“ä¸»é”®
dcloud_appid: ["67b0b5993f1a473bba2a16789"]  â† å¯èƒ½å­˜è¿™ä¸ª
uid: "å…¶ä»–å€¼"
wx_openid: ["oABC123..."]
```

### æƒ…å†µ2ï¼šuserInfo å­˜å‚¨ç»“æ„

å¯èƒ½çš„ç»“æ„ï¼š
```javascript
{
  _id: "xxx",  // å¯èƒ½ä¸æ˜¯æ•°æ®åº“_id
  uid: "67b0b5993f1a473bba2a16789",  // å¯èƒ½æ˜¯ dcloud_appid
  dcloud_appid: ["67d0b5993f1a473bba2a16789"],  // çœŸæ­£çš„æ•°æ®åº“å…³è”
  ...
}
```

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### å‘½ä»¤1ï¼šæŸ¥çœ‹å®Œæ•´userInfo
```javascript
console.log(JSON.stringify(uni.getStorageSync('userInfo'), null, 2))
```

### å‘½ä»¤2ï¼šæ‰‹åŠ¨è®¾ç½®æ­£ç¡®çš„ç”¨æˆ·ID
```javascript
const userInfo = uni.getStorageSync('userInfo')
userInfo._id = '67d0b5993f1a473bba2a16789'  // ä½¿ç”¨æ•°æ®åº“çš„_id
uni.setStorageSync('userInfo', userInfo)
```

### å‘½ä»¤3ï¼šç›´æ¥è·³è½¬æµ‹è¯•é¡µé¢
```javascript
uni.navigateTo({
  url: '/pages/article/testCashback'
})
```

---

## ğŸ’¡ å»ºè®®

1. **å…ˆç”¨æ–¹æ¡ˆä¸€æ‰‹åŠ¨è¾“å…¥IDæµ‹è¯•**ï¼ŒéªŒè¯è½¬è´¦åŠŸèƒ½æœ¬èº«æ˜¯å¦æ­£å¸¸
2. **å¦‚æœè½¬è´¦æˆåŠŸ**ï¼Œè¯´æ˜é…ç½®æ­£ç¡®ï¼Œåªéœ€è¦ä¿®å¤IDè·å–é€»è¾‘
3. **ä¸Šä¼ æ–°çš„äº‘å‡½æ•°**ï¼Œå®ƒä¼šå°è¯•å¤šç§æ–¹å¼æŸ¥æ‰¾ç”¨æˆ·
4. **æœ€åä¿®å¤å‰ç«¯**ï¼Œä½¿ç”¨æ­£ç¡®çš„å­—æ®µè·å–ç”¨æˆ·ID

---

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰
