# 图片水印功能使用说明

## 功能概述

项目已集成完整的图片水印功能,支持为图片自动添加文字或logo水印,具有以下特点:

✅ **支持自定义水印内容** - 可设置文字或logo图片  
✅ **支持自定义位置** - 默认右上角,支持9个位置  
✅ **支持自定义透明度** - 0-100%可调  
✅ **支持自定义大小** - 字体大小、logo尺寸可调  
✅ **自动适配设备** - 不同屏幕尺寸都能正常显示  
✅ **基于七牛云** - 利用七牛云图片处理能力,性能优越  

---

## 快速开始

### 方式1: 使用全局配置(推荐)

**步骤1: 启用全局水印**

```javascript
import { setWatermarkEnabled } from '@/utils/domainConfig.js'

// 在App.vue的onLaunch中启用
setWatermarkEnabled(true)
```

**步骤2: 正常使用图片处理函数**

```javascript
import { addListImageParams } from '@/utils/domainConfig.js'

// 使用addListImageParams会自动添加水印(如果全局已启用)
const imageUrl = addListImageParams(originalUrl)
```

```vue
<template>
  <image :src="addListImageParams(imageUrl)" />
</template>
```

### 方式2: 单独使用水印工具

```javascript
import { getWatermarkedImageUrl } from '@/utils/watermarkHelper.js'

// 为单个图片添加默认水印
const watermarkedUrl = getWatermarkedImageUrl(imageUrl)
```

```vue
<template>
  <image :src="getWatermarkedImageUrl(imageUrl)" />
</template>
```

### 方式3: 自定义水印参数

```javascript
import { addQiniuWatermark } from '@/utils/watermarkHelper.js'

// 自定义水印配置
const watermarkedUrl = addQiniuWatermark(imageUrl, {
  type: 'text',        // 水印类型
  text: '我的水印',    // 水印文字
  fontSize: 16,        // 字体大小
  opacity: 70,         // 透明度
  position: 'SouthEast', // 位置(右下角)
  dx: 15,              // X轴偏移
  dy: 15               // Y轴偏移
})
```

### 方式4: 批量添加水印

```javascript
import { batchAddWatermark } from '@/utils/watermarkHelper.js'

// 批量处理图片数组
const imageUrls = ['url1', 'url2', 'url3']
const watermarkedUrls = batchAddWatermark(imageUrls, {
  text: '批量水印',
  opacity: 60
})
```

---

## 配置说明

### 水印类型 (type)

- `'text'` - 文字水印 (默认)
- `'image'` - 图片水印 (logo)

### 位置参数 (position)

| 值 | 说明 | 值 | 说明 |
|---|---|---|---|
| `NorthWest` | 左上角 | `North` | 顶部居中 |
| `NorthEast` | 右上角 | `West` | 左侧居中 |
| `Center` | 正中央 | `East` | 右侧居中 |
| `SouthWest` | 左下角 | `South` | 底部居中 |
| `SouthEast` | **右下角(默认)** | - | - |

### 完整参数列表

```javascript
{
  type: 'text',          // 水印类型: 'text' | 'image'
  text: '本站专属',       // 文字水印内容
  fontSize: 14,          // 字体大小(px)
  opacity: 55,           // 透明度(0-100)
  position: 'SouthEast', // 位置
  dx: 10,                // X轴偏移(px)
  dy: 10,                // Y轴偏移(px)
  color: '#FFFFFF',      // 文字颜色(十六进制)
  logoUrl: ''            // logo图片URL(用于图片水印)
}
```

---

## 管理功能

### 水印配置管理页面

访问路径: `/subPages/watermarkConfig/watermarkConfig`

功能包括:
- 启用/关闭水印
- 选择水印类型
- 设置水印文字
- 调整字体大小
- 调整透明度
- 选择水印位置
- 调整偏移量
- 实时预览效果

### 使用示例页面

访问路径: `/subPages/watermarkDemo/watermarkDemo`

提供完整的使用示例和代码参考。

---

## API文档

### domainConfig.js

#### `setWatermarkEnabled(enabled)`
设置全局水印启用状态

**参数:**
- `enabled` (boolean) - 是否启用水印

**示例:**
```javascript
setWatermarkEnabled(true) // 启用全局水印
```

#### `getWatermarkEnabled()`
获取全局水印启用状态

**返回:**
- (boolean) - 是否启用

#### `updateWatermarkConfig(config)`
更新全局水印配置

**参数:**
- `config` (object) - 水印配置对象

**示例:**
```javascript
updateWatermarkConfig({
  text: '新水印',
  opacity: 70
})
```

#### `getWatermarkedUrl(url, watermarkOptions)`
获取带水印的图片URL

**参数:**
- `url` (string) - 原始图片URL
- `watermarkOptions` (object, 可选) - 水印配置

**返回:**
- (string) - 带水印的图片URL

#### `addListImageParams(url, addWatermark)`
为列表图片添加处理参数

**参数:**
- `url` (string) - 原始图片URL
- `addWatermark` (boolean, 可选) - 是否添加水印,默认使用全局配置

**返回:**
- (string) - 处理后的图片URL

---

### watermarkHelper.js

#### `getWatermarkedImageUrl(imageUrl, watermarkOptions)`
为图片添加水印(推荐使用)

**参数:**
- `imageUrl` (string) - 原始图片URL
- `watermarkOptions` (object, 可选) - 水印配置

**返回:**
- (string) - 带水印的图片URL

#### `addQiniuWatermark(imageUrl, options)`
使用七牛云水印功能添加水印

**参数:**
- `imageUrl` (string) - 图片URL(必须是七牛云图片)
- `options` (object, 可选) - 水印配置

**返回:**
- (string) - 添加水印参数后的URL

#### `batchAddWatermark(imageUrls, options)`
批量添加水印

**参数:**
- `imageUrls` (Array<string>) - 图片URL数组
- `options` (object, 可选) - 水印配置

**返回:**
- (Array<string>) - 带水印的图片URL数组

#### `updateWatermarkConfig(newConfig)`
更新水印配置

**参数:**
- `newConfig` (object) - 新的水印配置

#### `getWatermarkConfig()`
获取当前水印配置

**返回:**
- (object) - 当前水印配置

---

## 实际应用场景

### 场景1: 文章列表图片

```vue
<script setup>
import { addListImageParams } from '@/utils/domainConfig.js'

const processedImages = computed(() => {
  return article.images.map(img => addListImageParams(img.url))
})
</script>

<template>
  <image 
    v-for="(img, index) in processedImages" 
    :key="index"
    :src="img"
  />
</template>
```

### 场景2: 用户头像(不添加水印)

```javascript
import { addListImageParams } from '@/utils/domainConfig.js'

// 头像不添加水印
const avatarUrl = addListImageParams(url, false)
```

### 场景3: 图片预览(高清水印)

```javascript
import { addQiniuWatermark } from '@/utils/watermarkHelper.js'

const previewUrl = addQiniuWatermark(originalUrl, {
  fontSize: 20,  // 预览时使用更大的水印
  opacity: 70
})
```

### 场景4: 分类图标(自定义水印)

```javascript
import { getWatermarkedImageUrl } from '@/utils/watermarkHelper.js'

const categoryIcon = getWatermarkedImageUrl(iconUrl, {
  position: 'NorthEast',  // 右上角
  text: '官方',
  fontSize: 12
})
```

---

## 注意事项

⚠️ **重要提示**

1. **七牛云限制**: 水印功能仅支持七牛云图片(域名为 `aly2.jingle0350.cn`)
2. **性能考虑**: 水印是通过URL参数实现的,不会影响性能
3. **缓存问题**: 修改水印参数后,浏览器可能会缓存旧图片
4. **中文支持**: 中文文字需要base64编码,已自动处理
5. **图片格式**: 支持jpg、png等常见格式

---

## 常见问题

### Q: 水印不显示?
**A:** 检查以下几点:
1. 图片是否为七牛云图片
2. 全局水印是否已启用
3. 水印透明度是否过低
4. 水印位置是否被遮挡

### Q: 如何只给部分图片添加水印?
**A:** 使用参数控制:
```javascript
// 启用水印
addListImageParams(url, true)

// 不添加水印
addListImageParams(url, false)
```

### Q: 如何修改默认水印文字?
**A:** 两种方式:
1. 在配置管理页面修改并保存
2. 通过代码更新:
```javascript
import { updateWatermarkConfig } from '@/utils/domainConfig.js'

updateWatermarkConfig({
  text: '新的水印文字'
})
```

### Q: 水印能否使用自己的logo?
**A:** 可以,设置水印类型为 `image` 并提供logo URL:
```javascript
addQiniuWatermark(imageUrl, {
  type: 'image',
  logoUrl: 'https://your-domain.com/logo.png'
})
```

---

## 最佳实践

✅ **推荐做法**

1. **统一管理**: 使用全局配置管理水印,避免硬编码
2. **按需启用**: 根据业务需求启用水印,不是所有图片都需要
3. **合理透明度**: 建议透明度50-70%,既保护版权又不影响观感
4. **位置选择**: 右下角(SouthEast)最常用且不影响主体内容
5. **文字简洁**: 水印文字不宜过长,3-6个字为佳

❌ **避免做法**

1. 不要在每个组件中硬编码水印参数
2. 不要设置过高的透明度(影响美观)
3. 不要在非七牛云图片上使用(无效)
4. 不要频繁修改水印配置(影响缓存)

---

## 技术支持

如有问题,请查看:
- 示例页面: `/subPages/watermarkDemo/watermarkDemo`
- 配置页面: `/subPages/watermarkConfig/watermarkConfig`
- 工具文件: `/utils/watermarkHelper.js`
- 配置文件: `/utils/domainConfig.js`

---

## 更新日志

### v1.0.0 (2025-11-06)
- ✅ 实现基础水印功能
- ✅ 支持文字和图片水印
- ✅ 支持自定义位置、透明度、大小
- ✅ 集成到domainConfig
- ✅ 创建配置管理页面
- ✅ 创建使用示例页面
- ✅ 编写完整文档

---

**开发者**: AI Assistant  
**最后更新**: 2025-11-06
