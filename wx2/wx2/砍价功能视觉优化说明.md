# 砍价功能视觉优化说明

## 优化内容

### 1. **价格对比显示**
现在砍价组件会清晰地展示：
- **原价**（灰色删除线）- 让用户看到活动价值
- **当前价**（大字突出，红色）- 实时显示砍价后的价格
- **已砍金额**（红色突出）- 直观看到砍了多少钱

### 2. **进度条优化**
- 进度条更粗，更容易查看
- 进度条内显示百分比（当进度超过10%时）
- 进度条下方也显示百分比标签
- 使用渐变色（红色系）突出砍价成功的感觉

### 3. **剩余次数提示**
- 显示今日剩余砍价次数
- 帮助用户合理安排砍价时机

### 4. **飘红动画效果**
每次砍价成功后，会在组件上方飘出红色的"-¥XX.XX"文字，向上飘动并逐渐消失，增强视觉反馈。

## 使用方法

### 在文章详情页使用

```vue
<dianzan
  mode="bargain"
  :article-id="article._id"
  :initial-price="article.bargain_initial_price"
  :bargain-step="article.bargain_step"
  :show-text="true"
  bargain-text="帮砍一刀"
  bargain-complete-text="砍价成功"
/>
```

## 视觉效果说明

### 砍价前
```
原价: ¥1000.00
   [图标] ¥1000.00
   帮砍一刀
   今日剩余 3 次
   [=========>-----] 0%
```

### 砍价中（砍掉¥300）
```
原价: ¥1000.00              -¥10.00 ↑ (飘红动画)
   [图标] ¥700.00
已砍: ¥300.00
   帮砍一刀
   今日剩余 2 次
   [=====================>---------] 30%
```

### 砍价完成
```
   [✓] ¥0.00
已砍: ¥1000.00
   砍价成功
   [================================] 100%
```

## 技术实现

### 新增状态管理
- `remainingTimes`: 剩余砍价次数
- `lastBargainAmount`: 最后一次砍价金额
- `showFloatText`: 控制飘红动画显示

### 新增计算属性
- `totalBargained`: 计算总共砍掉的金额
- `bargainProgress`: 返回整数百分比

### 动画效果
1. **飘红动画**（floatUp）：
   - 持续时间：1.5秒
   - 效果：向上移动80rpx并逐渐透明

2. **砍价成功动画**（bargainSuccess）：
   - 持续时间：0.6秒
   - 效果：放大并旋转，产生庆祝效果

## 数据流程

```
用户点击砍价
    ↓
调用云函数 bargain()
    ↓
返回结果包含:
  - current_price (当前价格)
  - is_complete (是否完成)
  - bargain_amount (本次砍价金额)
  - remaining_times (剩余次数)
  - progress (进度百分比)
    ↓
更新组件状态 + 显示飘红动画
    ↓
触发全局事件通知其他组件
```

## 样式调整建议

### 如需调整组件宽度
```scss
&.bargain-mode {
  min-width: 200rpx; // 可根据需要调整
  padding: 16rpx;    // 内边距
}
```

### 如需调整进度条样式
```scss
.bargain-progress {
  width: 160rpx;     // 进度条宽度
  height: 12rpx;     // 进度条高度
  background-color: #f0f0f0; // 背景色
}
```

### 如需调整飘红文字大小
```scss
.bargain-float-text {
  font-size: 32rpx;  // 文字大小
  color: #ff6b6b;    // 颜色
}
```

## 注意事项

1. **组件必须设置 `position: relative`**，以便飘红文字正确定位
2. **初始价格不能为0**，否则进度条会显示100%
3. **云函数必须返回 `remaining_times` 字段**，组件才能显示剩余次数
4. **建议在文章发布时设置合理的砍价金额**，确保用户能看到明显的进度变化

## 扩展功能建议

### 可以进一步添加：
1. **砍价历史记录弹窗**：显示所有砍价记录
2. **分享功能**：邀请好友帮砍价
3. **排行榜**：显示砍价最多的用户
4. **优惠券**：砍价完成后发放优惠券
5. **实时通知**：有人砍价时通知文章作者

## 测试建议

1. 测试初始状态显示
2. 测试砍价动画效果
3. 测试剩余次数正确性
4. 测试砍价完成状态
5. 测试网络异常回滚
6. 测试防刷机制（5秒间隔、每日3次限制）
