{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script setup>\nimport { onLaunch, onShow, onHide } from '@dcloudio/uni-app'\nimport { useUserInfoStore } from '@/store/user.js'\n\nconst userStore = useUserInfoStore()\n\nonLaunch((options) => {\n\tconsole.log('App Launch')\n\tconsole.log('启动参数:', options)\n\t\n\t// 检查登录状态\n\tcheckLoginStatus()\n\t\n\t// 开启平台原生页面分享\n\tuni.showShareMenu({\n\t\twithShareTicket: true\n\t})\n})\n\nonShow(() => {\n\tconsole.log('App Show')\n\t// 每次应用显示时也检查登录状态\n\tcheckLoginStatus()\n})\n\nonHide(() => {\n\tconsole.log('App Hide')\n})\n\n// 检查登录状态函数\nconst checkLoginStatus = () => {\n\t// 检查 store 中是否有用户信息\n\tif (userStore.userInfo && userStore.userInfo.uid && userStore.userInfo.isLogin) {\n\t\tconsole.log('用户已登录:', userStore.userInfo.nickName)\n\t\treturn true\n\t}\n\t\n\t// 检查本地存储\n\tconst storageUserInfo = uni.getStorageSync('userInfo')\n\tif (storageUserInfo && storageUserInfo.uid && storageUserInfo.isLogin) {\n\t\tconsole.log('从本地存储恢复登录状态:', storageUserInfo.nickName)\n\t\tuserStore.setUserInfo(storageUserInfo)\n\t\treturn true\n\t}\n\t\n\tconsole.log('用户未登录')\n\treturn false\n}\n</script>\n\n<style>\n\t/* 每个页面公共css */\n\tbody {\n\t\tbackground-color: #f5f5f5;\n\t}\n</style>\n","import App from './App'\nimport { createSSRApp } from 'vue'\nimport { createPinia } from 'pinia'\n\n// 自定义持久化插件函数\nconst createPersistedState = (options = {}) => {\n\tconst storage = {\n\t\tgetItem: (key) => uni.getStorageSync(key),\n\t\tsetItem: (key, value) => uni.setStorageSync(key, value)\n\t}\n\t\n\treturn ({ store }) => {\n\t\t// 判断当前store是否需要持久化\n\t\tif (!options.stores || options.stores.includes(store.$id)) {\n\t\t\tconst storageKey = `${options.prefix || 'pinia'}-${store.$id}`;\n\t\t\t\n\t\t\t// 从存储中恢复状态\n\t\t\tconst persisted = storage.getItem(storageKey);\n\t\t\tif (persisted) {\n\t\t\t\tstore.$patch(JSON.parse(persisted));\n\t\t\t}\n\t\t\t\n\t\t\t// 监听变更并保存\n\t\t\tstore.$subscribe((_, state) => {\n\t\t\t\tstorage.setItem(storageKey, JSON.stringify(state));\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport function createApp() {\n\tconst app = createSSRApp(App)\n\tconst pinia = createPinia()\n\t\n\t// 使用自定义持久化插件\n\tpinia.use(createPersistedState({\n\t\tstores: ['userInfo'],\n\t\tprefix: 'shop1-'\n\t}));\n\t\n\tapp.use(pinia)\n\t\n\t// 挂载全局请求方法\n\tapp.config.globalProperties.$request = function(options) {\n\t\tconst token = uni.getStorageSync('token');\n\t\tconst baseUrl = 'https://shop.jingle0350.cn/shop1/php1/api.php'; // 对应后端的地址\n\t\t\n\t\t// 处理路由路径，去除前导斜杠\n\t\tconst path = options.url.startsWith('/') ? options.url.substring(1) : options.url;\n\t\tconst fullUrl = `${baseUrl}?path=${path}`;\n\t\t\n\t\tconsole.log('[Request] URL:', fullUrl);\n\t\tconsole.log('[Request] Method:', options.method || 'GET');\n\t\tconsole.log('[Request] Data:', options.data);\n\t\t\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tuni.request({\n\t\t\t\turl: fullUrl,\n\t\t\t\tmethod: options.method || 'GET',\n\t\t\t\tdata: options.data || {},\n\t\t\t\theader: {\n\t\t\t\t\t'Authorization': token ? 'Bearer ' + token : '',\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t...options.header\n\t\t\t\t},\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tconsole.log('[Response] Status:', res.statusCode);\n\t\t\t\t\tconsole.log('[Response] Data:', res.data);\n\t\t\t\t\t\n\t\t\t\t\tif (res.data.success === false && res.data.message === '令牌已过期') {\n\t\t\t\t\t\tuni.removeStorageSync('token');\n\t\t\t\t\t\tuni.navigateTo({ url: '/pages/login/login' });\n\t\t\t\t\t\treject(res.data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(res.data);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfail: (err) => {\n\t\t\t\t\tconsole.error('[Request] Fail:', err);\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\t\n\treturn {\n\t\tapp\n\t}\n}\n"],"names":["useUserInfoStore","onLaunch","uni","onShow","onHide","createSSRApp","App","createPinia"],"mappings":"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"}