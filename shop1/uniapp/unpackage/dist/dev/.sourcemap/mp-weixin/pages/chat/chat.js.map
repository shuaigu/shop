{"version":3,"file":"chat.js","sources":["pages/chat/chat.vue","../../../软件/HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdC9jaGF0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<scroll-view scroll-y class=\"chat-list\" :scroll-into-view=\"lastId\">\n\t\t\t<view v-for=\"(item, index) in messages\" :key=\"item.id\" :id=\"'msg-' + item.id\" class=\"msg-row\" :class=\"{ 'msg-me': item.sender_id == myId }\">\n\t\t\t\t<image :src=\"item.avatar || '/static/default_avatar.png'\" class=\"avatar\"></image>\n\t\t\t\t<view class=\"msg-content\">\n\t\t\t\t\t<view v-if=\"item.message_type === 'text'\" class=\"bubble\">{{ item.content }}</view>\n\t\t\t\t\t<image v-else-if=\"item.message_type === 'image'\" :src=\"item.file_url\" mode=\"widthFix\" class=\"img-msg\"></image>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\n\t\t<view class=\"input-area\">\n\t\t\t<input v-model=\"content\" class=\"input\" confirm-type=\"send\" @confirm=\"sendMsg\" />\n\t\t\t<button @click=\"sendMsg\" class=\"send-btn\">发送</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, nextTick, getCurrentInstance } from 'vue'\nimport { onLoad } from '@dcloudio/uni-app'\n\nconst id = ref('')\nconst name = ref('')\nconst messages = ref([])\nconst content = ref('')\nconst myId = ref('')\nconst lastId = ref('')\n\nconst { proxy } = getCurrentInstance()\n\nonLoad((options) => {\n\tid.value = options.id\n\tname.value = options.name\n\tuni.setNavigationBarTitle({ title: name.value })\n\tconst user = JSON.parse(uni.getStorageSync('user') || '{}')\n\tmyId.value = user.id\n\tfetchMessages()\n})\n\nconst fetchMessages = async () => {\n\ttry {\n\t\tconst res = await proxy.$request({ url: `/conversations/messages?conversation_id=${id.value}` })\n\t\tif (res.success) {\n\t\t\tmessages.value = res.data.reverse()\n\t\t\tif (messages.value.length > 0) {\n\t\t\t\tnextTick(() => {\n\t\t\t\t\tlastId.value = 'msg-' + messages.value[messages.value.length - 1].id\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t} catch (e) {}\n}\n\nconst sendMsg = async () => {\n\tif (!content.value) return\n\ttry {\n\t\tconst res = await proxy.$request({\n\t\t\turl: '/conversations/messages',\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tconversation_id: id.value,\n\t\t\t\tcontent: content.value,\n\t\t\t\tmessage_type: 'text'\n\t\t\t}\n\t\t})\n\t\tif (res.success) {\n\t\t\tcontent.value = ''\n\t\t\tfetchMessages()\n\t\t}\n\t} catch (e) {}\n}\n</script>\n\n<style>\n\t.container { display: flex; flex-direction: column; height: 100vh; background-color: #f5f5f5; }\n\t.chat-list { flex: 1; padding: 20rpx; }\n\t.msg-row { display: flex; margin-bottom: 30rpx; }\n\t.msg-me { flex-direction: row-reverse; }\n\t.avatar { width: 80rpx; height: 80rpx; border-radius: 10rpx; }\n\t.msg-content { margin: 0 20rpx; max-width: 70%; }\n\t.bubble { background-color: #fff; padding: 20rpx; border-radius: 10rpx; font-size: 30rpx; word-break: break-all; }\n\t.msg-me .bubble { background-color: #95ec69; }\n\t.img-msg { border-radius: 10rpx; width: 300rpx; }\n\t\n\t.input-area { display: flex; padding: 20rpx; background-color: #fff; border-top: 1px solid #ddd; }\n\t.input { flex: 1; background-color: #f5f5f5; height: 80rpx; padding: 0 20rpx; border-radius: 10rpx; }\n\t.send-btn { background-color: #07c160; color: #fff; height: 80rpx; line-height: 80rpx; margin-left: 20rpx; font-size: 28rpx; }\n</style>\n","import MiniProgramPage from 'D:/代码测试/shop1/uniapp/pages/chat/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","getCurrentInstance","onLoad","uni","nextTick","MiniProgramPage"],"mappings":";;;;;AAuBA,UAAM,KAAKA,cAAG,IAAC,EAAE;AACjB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,UAAUA,cAAG,IAAC,EAAE;AACtB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,SAASA,cAAG,IAAC,EAAE;AAErB,UAAM,EAAE,MAAO,IAAGC,iCAAoB;AAEtCC,kBAAM,OAAC,CAAC,YAAY;AACnB,SAAG,QAAQ,QAAQ;AACnB,WAAK,QAAQ,QAAQ;AACrBC,oBAAAA,MAAI,sBAAsB,EAAE,OAAO,KAAK,MAAK,CAAE;AAC/C,YAAM,OAAO,KAAK,MAAMA,cAAG,MAAC,eAAe,MAAM,KAAK,IAAI;AAC1D,WAAK,QAAQ,KAAK;AAClB,oBAAe;AAAA,IAChB,CAAC;AAED,UAAM,gBAAgB,YAAY;AACjC,UAAI;AACH,cAAM,MAAM,MAAM,MAAM,SAAS,EAAE,KAAK,2CAA2C,GAAG,KAAK,IAAI;AAC/F,YAAI,IAAI,SAAS;AAChB,mBAAS,QAAQ,IAAI,KAAK,QAAS;AACnC,cAAI,SAAS,MAAM,SAAS,GAAG;AAC9BC,0BAAAA,WAAS,MAAM;AACd,qBAAO,QAAQ,SAAS,SAAS,MAAM,SAAS,MAAM,SAAS,CAAC,EAAE;AAAA,YACvE,CAAK;AAAA,UACD;AAAA,QACD;AAAA,MACH,SAAU,GAAG;AAAA,MAAE;AAAA,IACf;AAEA,UAAM,UAAU,YAAY;AAC3B,UAAI,CAAC,QAAQ;AAAO;AACpB,UAAI;AACH,cAAM,MAAM,MAAM,MAAM,SAAS;AAAA,UAChC,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACL,iBAAiB,GAAG;AAAA,YACpB,SAAS,QAAQ;AAAA,YACjB,cAAc;AAAA,UACd;AAAA,QACJ,CAAG;AACD,YAAI,IAAI,SAAS;AAChB,kBAAQ,QAAQ;AAChB,wBAAe;AAAA,QACf;AAAA,MACH,SAAU,GAAG;AAAA,MAAE;AAAA,IACf;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvEA,GAAG,WAAWC,SAAe;"}