{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../软件/HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"index\">\r\n\t\t<view class=\"header\">\r\n\t\t\t<text class=\"title\">首页</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"article-list\">\r\n\t\t\t\t<view class=\"article-item\" v-for=\"item in articleList\" :key=\"item.id\">\r\n\t\t\t\t\t<view class=\"article-title\">{{ item.title }}</view>\r\n\t\t\t\t\t<view class=\"article-content\">{{ item.content }}</view>\r\n\t\t\t\t\t<view class=\"article-author\">作者：{{ item.author }}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"tips\" v-if=\"!userStore.userInfo.isLogin\">\r\n\t\t\t\t<button @click=\"goLogin\">请先登录</button>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<!-- 支付按钮 -->\r\n\t\t\t<view class=\"pay-section\">\r\n\t\t\t\t<button class=\"pay-btn\" @click=\"handlePay\" :disabled=\"payLoading\">\r\n\t\t\t\t\t{{ payLoading ? '支付中...' : '立即支付' }}\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useUserInfoStore } from '@/store/user.js'\r\nimport { testLogin } from '@/utils/isLogin'\r\nimport { onPullDownRefresh, onShow } from '@dcloudio/uni-app'\r\n\r\nconst userStore = useUserInfoStore()\r\n\r\n// 文章列表\r\nconst articleList = ref([])\r\nconst loading = ref(false)\r\nconst pageNo = ref(1)\r\nconst pageSize = 10\r\n\r\n// 支付相关\r\nconst payLoading = ref(false)\r\n\r\n// 加载文章列表（调用PHP后端）\r\nconst loadArticles = async () => {\r\n\tif (loading.value) return\r\n\t\r\n\tloading.value = true\r\n\ttry {\r\n\t\tconst res = await uni.request({\r\n\t\t\turl: 'https://shop.jingle0350.cn/shop1/php1/api.php?path=articles',\r\n\t\t\tmethod: 'GET',\r\n\t\t\tdata: {\r\n\t\t\t\tpage: pageNo.value,\r\n\t\t\t\tpageSize: pageSize\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t\tif (res.data && res.data.code === 0) {\r\n\t\t\tarticleList.value = res.data.data || []\r\n\t\t} else {\r\n\t\t\tconsole.error('获取文章失败:', res.data)\r\n\t\t\tuni.showToast({ title: res.data.message || '加载失败', icon: 'none' })\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tconsole.error('加载文章失败:', err)\r\n\t\tuni.showToast({ title: '加载失败', icon: 'none' })\r\n\t} finally {\r\n\t\tloading.value = false\r\n\t}\r\n}\r\n\r\nonMounted(() => {\r\n\tconsole.log('首页加载')\r\n\tloadArticles()\r\n})\r\n\r\nonPullDownRefresh(async () => {\r\n\tpageNo.value = 1\r\n\tawait loadArticles()\r\n\tuni.stopPullDownRefresh()\r\n})\r\n\r\n// 跳转到登录页\r\nconst goLogin = () => {\r\n\tuni.navigateTo({ url: '/pages/login/login' })\r\n}\r\n\r\n// 处理支付\r\nconst handlePay = async () => {\r\n\t// 检查登录状态\r\n\tif (!userStore.userInfo.isLogin || !userStore.userInfo.uid) {\r\n\t\t// 未登录，弹出登录提示\r\n\t\tuni.showModal({\r\n\t\t\ttitle: '提示',\r\n\t\t\tcontent: '请先登录后再进行支付',\r\n\t\t\tconfirmText: '去登录',\r\n\t\t\tcancelText: '取消',\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\tgoLogin()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn\r\n\t}\r\n\t\r\n\tpayLoading.value = true\r\n\t\r\n\ttry {\r\n\t\t// 生成订单号\r\n\t\tconst out_trade_no = 'ORDER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)\r\n\t\t\r\n\t\t// 获取用户openid\r\n\t\tconst openid = userStore.userInfo.openid\r\n\t\t\r\n\t\tif (!openid) {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '用户信息异常，请重新登录',\r\n\t\t\t\tconfirmText: '重新登录',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t// 清除旧的登录信息\r\n\t\t\t\t\t\tuserStore.cleanUserInfo()\r\n\t\t\t\t\t\tuni.removeStorageSync('userInfo')\r\n\t\t\t\t\t\tgoLogin()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\t// 调用云函数生成支付参数\r\n\t\tconst wxpay = uniCloud.importObject('wxpay')\r\n\t\tconst payResult = await wxpay.wxpay({\r\n\t\t\topenid: openid,\r\n\t\t\tout_trade_no: out_trade_no,\r\n\t\t\ttotal_fee: 1 // 金额（分），这里设置为0.01元作为测试\r\n\t\t})\r\n\t\t\r\n\t\tconsole.log('支付参数:', payResult)\r\n\t\t\r\n\t\t// 调用微信支付\r\n\t\tuni.requestPayment({\r\n\t\t\tprovider: 'wxpay',\r\n\t\t\ttimeStamp: payResult.timeStamp,\r\n\t\t\tnonceStr: payResult.nonceStr,\r\n\t\t\tpackage: payResult.package,\r\n\t\t\tsignType: payResult.signType,\r\n\t\t\tpaySign: payResult.paySign,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log('支付成功:', res)\r\n\t\t\t\tuni.showToast({ title: '保存成功', icon: 'success' })\r\n\t\t\t\t// 这里可以进行后续业务处理\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.error('支付失败:', err)\r\n\t\t\t\tif (err.errMsg.includes('cancel')) {\r\n\t\t\t\t\tuni.showToast({ title: '取消支付', icon: 'none' })\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({ title: '支付失败', icon: 'none' })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t} catch (err) {\r\n\t\tconsole.error('支付错误:', err)\r\n\t\tuni.showToast({ title: err.message || '支付异常', icon: 'none' })\r\n\t} finally {\r\n\t\tpayLoading.value = false\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n.index {\r\n\tmin-height: 100vh;\r\n\tbackground-color: #f5f5f5;\r\n}\r\n\r\n.header {\r\n\tpadding: 30rpx;\r\n\tbackground: linear-gradient(135deg, #46b0fe, #6385ff);\r\n\tcolor: #fff;\r\n}\r\n\r\n.header .title {\r\n\tfont-size: 40rpx;\r\n\tfont-weight: bold;\r\n}\r\n\r\n.content {\r\n\tpadding: 30rpx;\r\n}\r\n\r\n.article-list {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.article-item {\r\n\tbackground: #fff;\r\n\tpadding: 30rpx;\r\n\tborder-radius: 16rpx;\r\n\tmargin-bottom: 20rpx;\r\n\tbox-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);\r\n}\r\n\r\n.article-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.article-content {\r\n\tfont-size: 28rpx;\r\n\tcolor: #666;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.article-author {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n}\r\n\r\n.tips {\r\n\ttext-align: center;\r\n\tpadding: 40rpx 0;\r\n}\r\n\r\n.tips button {\r\n\tbackground: linear-gradient(135deg, #46b0fe, #6385ff);\r\n\tcolor: #fff;\r\n\tborder: none;\r\n\tpadding: 20rpx 60rpx;\r\n\tborder-radius: 40rpx;\r\n}\r\n\r\n/* 支付按钮样式 */\r\n.pay-section {\r\n\tmargin-top: 40rpx;\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.pay-btn {\r\n\twidth: 100%;\r\n\tbackground: linear-gradient(135deg, #ff6b6b, #ff8e53);\r\n\tcolor: #fff;\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tborder: none;\r\n\tpadding: 30rpx 0;\r\n\tborder-radius: 50rpx;\r\n\tbox-shadow: 0 8rpx 20rpx rgba(255, 107, 107, 0.3);\r\n}\r\n\r\n.pay-btn[disabled] {\r\n\topacity: 0.6;\r\n\tbackground: linear-gradient(135deg, #ccc, #999);\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/代码测试/shop1/uniapp/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserInfoStore","ref","uni","onMounted","onPullDownRefresh","uniCloud","MiniProgramPage"],"mappings":"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"}