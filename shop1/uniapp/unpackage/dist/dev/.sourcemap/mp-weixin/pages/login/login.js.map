{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../ËΩØ‰ª∂/HBuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"login-container\">\r\n\t\t<view class=\"logo-section\">\r\n\t\t\t<view class=\"logo-placeholder\">\r\n\t\t\t\t<text class=\"logo-text\">üõãÔ∏è</text>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"app-name\">Shop1</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"form-section\">\r\n\t\t\t<view class=\"social-login\">\r\n\t\t\t\t<button class=\"wx-login-btn\" @click=\"handleWxLogin\">\r\n\t\t\t\t\tüëã ÂæÆ‰ø°‰∏ÄÈîÆÁôªÂΩï\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"agreement\">\r\n\t\t\t<checkbox-group @change=\"agreementChange\">\r\n\t\t\t\t<label class=\"checkbox-label\">\r\n\t\t\t\t\t<checkbox value=\"agree\" :checked=\"isAgree\" style=\"transform:scale(0.7)\" color=\"#399bfe\" />\r\n\t\t\t\t\t<text class=\"agreement-text\">ÊàëÂ∑≤ÈòÖËØªÂπ∂ÂêåÊÑè<text class=\"blue\">„ÄäÁî®Êà∑ÂçèËÆÆ„Äã</text>Âíå<text class=\"blue\">„ÄäÈöêÁßÅÊîøÁ≠ñ„Äã</text></text>\r\n\t\t\t\t</label>\r\n\t\t\t</checkbox-group>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { useUserInfoStore } from '@/store/user.js'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\n\r\nconst userStore = useUserInfoStore()\r\nconst isAgree = ref(false)\r\nconst loading = ref(false)\r\nconst redirectUrl = ref('') // ÁôªÂΩïÂêéË∑≥ËΩ¨ÁöÑÈ°µÈù¢\r\n\r\n// Ëé∑ÂèñË∑≥ËΩ¨ÂèÇÊï∞\r\nonLoad((options) => {\r\n\tif (options.redirect) {\r\n\t\tredirectUrl.value = decodeURIComponent(options.redirect)\r\n\t\tconsole.log('ÁôªÂΩïÂêéÂ∞ÜË∑≥ËΩ¨Âà∞:', redirectUrl.value)\r\n\t}\r\n})\r\n\r\nconst agreementChange = (e) => {\r\n\tisAgree.value = e.detail.value.length > 0\r\n}\r\n\r\nconst handleWxLogin = async () => {\r\n\tif (!isAgree.value) {\r\n\t\treturn uni.showToast({ title: 'ËØ∑ÂÖàÈòÖËØªÂπ∂ÂêåÊÑèÂçèËÆÆ', icon: 'none' })\r\n\t}\r\n\t\r\n\tloading.value = true\r\n\ttry {\r\n\t\t// 1. Ëé∑ÂèñÂæÆ‰ø°code\r\n\t\tconsole.log('ÂºÄÂßãË∞ÉÁî® wx.login...')\r\n\t\tconst loginRes = await uni.login({ provider: 'weixin' })\r\n\t\t\r\n\t\tif (!loginRes || !loginRes.code) {\r\n\t\t\tconsole.error('wx.login Â§±Ë¥•:', loginRes)\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: 'ÁôªÂΩïÂ§±Ë¥•',\r\n\t\t\t\tcontent: 'Ëé∑ÂèñÂæÆ‰ø°ÊéàÊùÉÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Ôºö\\n1. ÊòØÂê¶Âú®ÂæÆ‰ø°ÂºÄÂèëËÄÖÂ∑•ÂÖ∑‰∏≠\\n2. ÊòØÂê¶ÈÖçÁΩÆ‰∫ÜÊ≠£Á°ÆÁöÑ AppID\\n3. ÊòØÂê¶ÂºÄÂêØ‰∫Ü‚Äú‰∏çÊ†°È™åÂêàÊ≥ïÂüüÂêç‚Äù',\r\n\t\t\t\tshowCancel: false\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log('Ëé∑ÂèñÂà∞ code:', loginRes.code)\r\n\t\t\r\n\t\t// 2. Ë∞ÉÁî®PHPÂêéÁ´ØÁôªÂΩïÊé•Âè£\r\n\t\tconsole.log('ÂºÄÂßãË∞ÉÁî®ÂêéÁ´ØÁôªÂΩïÊé•Âè£...')\r\n\t\tconst res = await uni.request({\r\n\t\t\turl: 'https://shop.jingle0350.cn/shop1/php1/api.php?path=wx-login',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\tcode: loginRes.code\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t\tconsole.log('ÂêéÁ´ØÁôªÂΩïÂìçÂ∫î:', res.data)\r\n\t\t\r\n\t\tif (res.data && res.data.success) {\r\n\t\t\tconst loginData = res.data.data\r\n\t\t\tconst userData = loginData.userInfo\r\n\t\t\t\r\n\t\t\t// ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÔºåÂåÖÊã¨openid\r\n\t\t\tuserStore.setUserInfo({\r\n\t\t\t\tuid: userData._id,\r\n\t\t\t\tnickName: userData.nickName || 'ÂæÆ‰ø°Áî®Êà∑',\r\n\t\t\t\tavatarUrl: userData.avatarUrl || '/static/images/touxiang.png',\r\n\t\t\t\tmobile: userData.mobile || '138****8888',\r\n\t\t\t\topenid: userData.openid, // ‰øùÂ≠òopenidÁî®‰∫éÊîØ‰ªò\r\n\t\t\t\tisLogin: true,\r\n\t\t\t\ttoken: loginData.token,\r\n\t\t\t\trole: userData.role || ['user']\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\tconsole.log('Áî®Êà∑‰ø°ÊÅØÂ∑≤‰øùÂ≠ò:', userStore.userInfo)\r\n\t\t\t\r\n\t\t\tuni.showToast({ title: 'ÁôªÂΩïÊàêÂäü', icon: 'success' })\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t// Â¶ÇÊûúÊúâË∑≥ËΩ¨Âú∞ÂùÄÔºåÂàôË∑≥ËΩ¨Âà∞ÊåáÂÆöÈ°µÈù¢\r\n\t\t\t\tif (redirectUrl.value) {\r\n\t\t\t\t\tuni.redirectTo({ url: redirectUrl.value })\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Âê¶ÂàôË∑≥ËΩ¨Âà∞È¶ñÈ°µ\r\n\t\t\t\t\tuni.switchTab({ url: '/pages/index/index' })\r\n\t\t\t\t}\r\n\t\t\t}, 1000)\r\n\t\t} else {\r\n\t\t\tconst errorMsg = res.data.message || 'ÁôªÂΩïÂ§±Ë¥•'\r\n\t\t\tconsole.error('ÁôªÂΩïÂ§±Ë¥•:', errorMsg)\r\n\t\t\tuni.showToast({ title: errorMsg, icon: 'none', duration: 3000 })\r\n\t\t}\r\n\t} catch (e) {\r\n\t\tconsole.error('ÁôªÂΩïÂºÇÂ∏∏:', e)\r\n\t\tuni.showModal({\r\n\t\t\ttitle: 'ÁôªÂΩïÂ§±Ë¥•',\r\n\t\t\tcontent: 'ÁôªÂΩïËøáÁ®ãÂá∫Áé∞ÂºÇÂ∏∏Ôºö' + (e.errMsg || e.message || JSON.stringify(e)),\r\n\t\t\tshowCancel: false\r\n\t\t})\r\n\t} finally {\r\n\t\tloading.value = false\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n.login-container {\r\n\tpadding: 60rpx;\r\n\tbackground-color: #ffffff;\r\n\tmin-height: 100vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.logo-section {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\tmargin-top: 100rpx;\r\n\tmargin-bottom: 100rpx;\r\n}\r\n\r\n.logo-placeholder {\r\n\twidth: 160rpx;\r\n\theight: 160rpx;\r\n\tborder-radius: 30rpx;\r\n\tmargin-bottom: 20rpx;\r\n\tbackground: linear-gradient(135deg, #46b0fe, #6385ff);\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n}\r\n\r\n.logo-text {\r\n\tfont-size: 80rpx;\r\n}\r\n\r\n.app-name {\r\n\tfont-size: 40rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tletter-spacing: 4rpx;\r\n}\r\n\r\n.form-section {\r\n\tflex: 1;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n}\r\n\r\n.social-login {\r\n\tmargin-top: 80rpx;\r\n}\r\n\r\n.wx-login-btn {\r\n\twidth: 100%;\r\n\theight: 94rpx;\r\n\tline-height: 94rpx;\r\n\tbackground: linear-gradient(to right, #46b0fe, #6385ff);\r\n\tcolor: #ffffff;\r\n\tfont-size: 34rpx;\r\n\tborder-radius: 47rpx;\r\n\tbox-shadow: 0 10rpx 20rpx rgba(70, 176, 254, 0.3);\r\n\tborder: none;\r\n}\r\n\r\n.agreement {\r\n\tmargin-bottom: 60rpx;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n}\r\n\r\n.checkbox-label {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.agreement-text {\r\n\tfont-size: 24rpx;\r\n\tcolor: #999;\r\n}\r\n\r\n.blue {\r\n\tcolor: #399bfe;\r\n}\r\n</style>\r\n\r\n<style>\r\n\t.login-container {\r\n\t\tpadding: 60rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tmin-height: 100vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t\r\n\t.logo-section {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tmargin-top: 100rpx;\r\n\t\tmargin-bottom: 100rpx;\r\n\t}\r\n\t\r\n\t.logo-placeholder {\r\n\t\twidth: 160rpx;\r\n\t\theight: 160rpx;\r\n\t\tborder-radius: 30rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tbackground: linear-gradient(135deg, #007AFF, #00aaff);\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.logo-text {\r\n\t\tfont-size: 80rpx;\r\n\t}\r\n\t\r\n\t.logo {\r\n\t\twidth: 160rpx;\r\n\t\theight: 160rpx;\r\n\t\tborder-radius: 30rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tbackground-color: #f0f0f0; /* Âç†‰ΩçËâ≤ */\r\n\t}\r\n\t\r\n\t.app-name {\r\n\t\tfont-size: 40rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t\tletter-spacing: 4rpx;\r\n\t}\r\n\t\r\n\t.form-section {\r\n\t\tflex: 1;\r\n\t}\r\n\t\r\n\t.input-group {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\theight: 110rpx;\r\n\t\tborder-bottom: 1px solid #eeeeee;\r\n\t\tmargin-bottom: 40rpx;\r\n\t\tpadding: 0 10rpx;\r\n\t}\r\n\t\r\n\t.input {\r\n\t\tflex: 1;\r\n\t\theight: 80rpx;\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\t\r\n\t.eye-toggle {\r\n\t\tpadding: 0 20rpx;\r\n\t\tfont-size: 40rpx;\r\n\t}\r\n\t\r\n\t.login-btn {\r\n\t\twidth: 100%;\r\n\t\theight: 94rpx;\r\n\t\tline-height: 94rpx;\r\n\t\tbackground: linear-gradient(to right, #007AFF, #00aaff);\r\n\t\tcolor: #ffffff;\r\n\t\tfont-size: 34rpx;\r\n\t\tborder-radius: 47rpx;\r\n\t\tmargin-top: 60rpx;\r\n\t\tbox-shadow: 0 10rpx 20rpx rgba(0, 122, 255, 0.2);\r\n\t}\r\n\t\r\n\t.action-footer {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tmargin-top: 40rpx;\r\n\t}\r\n\t\r\n\t.link {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.sep {\r\n\t\tmargin: 0 30rpx;\r\n\t\tcolor: #eee;\r\n\t}\r\n\r\n\t.social-login {\r\n\t\tmargin-top: 80rpx;\r\n\t}\r\n\r\n\t.divider {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tmargin-bottom: 40rpx;\r\n\t}\r\n\r\n\t.divider::before,\r\n\t.divider::after {\r\n\t\tcontent: '';\r\n\t\tflex: 1;\r\n\t\theight: 1px;\r\n\t\tbackground-color: #eee;\r\n\t}\r\n\r\n\t.divider-text {\r\n\t\tpadding: 0 20rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.login-options {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.wx-login-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.wx-text {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tbackground-color: #07c160;\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: 50%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tfont-size: 24rpx;\r\n\t\tmargin-bottom: 10rpx;\r\n\t}\r\n\r\n\t.wx-label {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.agreement {\r\n\t\tmargin-bottom: 60rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.checkbox-label {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\t\r\n\t.agreement-text {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\t\r\n\t.blue {\r\n\t\tcolor: #007AFF;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/‰ª£Á†ÅÊµãËØï/shop1/uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserInfoStore","ref","onLoad","uni","MiniProgramPage"],"mappings":"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"}