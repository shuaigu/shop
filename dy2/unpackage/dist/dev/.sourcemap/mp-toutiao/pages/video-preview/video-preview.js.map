{"version":3,"file":"video-preview.js","sources":["pages/video-preview/video-preview.vue","D:/代码测试/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdmlkZW8tcHJldmlldy92aWRlby1wcmV2aWV3LnZ1ZQ"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted, onUnmounted, computed } from 'vue';\r\n\r\nconst videoUrl = ref('');\r\nconst thumbnailUrl = ref('');\r\nconst videoDuration = ref(0);\r\nconst videoSize = ref(0);\r\nconst videoWidth = ref(0);\r\nconst videoHeight = ref(0);\r\nconst videoContext = ref(null);\r\nconst isPlaying = ref(false);\r\nconst currentTime = ref(0);\r\nconst showControls = ref(true);\r\nconst controlsTimeout = ref(null);\r\n\r\n// 格式化时间为 mm:ss 格式\r\nconst formatTime = (seconds) => {\r\n  const min = Math.floor(seconds / 60);\r\n  const sec = Math.floor(seconds % 60);\r\n  return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;\r\n};\r\n\r\n// 格式化视频大小\r\nconst formatSize = (bytes) => {\r\n  if (bytes < 1024) {\r\n    return bytes + 'B';\r\n  } else if (bytes < 1024 * 1024) {\r\n    return (bytes / 1024).toFixed(2) + 'KB';\r\n  } else if (bytes < 1024 * 1024 * 1024) {\r\n    return (bytes / (1024 * 1024)).toFixed(2) + 'MB';\r\n  } else {\r\n    return (bytes / (1024 * 1024 * 1024)).toFixed(2) + 'GB';\r\n  }\r\n};\r\n\r\n// 计算视频时长格式化\r\nconst formattedDuration = computed(() => {\r\n  return formatTime(videoDuration.value);\r\n});\r\n\r\n// 计算当前播放时间格式化\r\nconst formattedCurrentTime = computed(() => {\r\n  return formatTime(currentTime.value);\r\n});\r\n\r\n// 计算视频大小格式化\r\nconst formattedSize = computed(() => {\r\n  return formatSize(videoSize.value);\r\n});\r\n\r\n// 计算视频分辨率\r\nconst resolution = computed(() => {\r\n  return `${videoWidth.value}x${videoHeight.value}`;\r\n});\r\n\r\nonMounted(() => {\r\n  // 修正：使用正确的uni-app API获取页面参数\r\n  const eventChannel = getOpenerEventChannel();\r\n  const pages = getCurrentPages();\r\n  const currentPage = pages[pages.length - 1];\r\n  const query = currentPage.options || {};\r\n  \r\n  console.log('视频预览页面参数:', query);\r\n  \r\n  if (query.videoUrl) {\r\n    videoUrl.value = decodeURIComponent(query.videoUrl);\r\n    console.log('视频URL:', videoUrl.value);\r\n  }\r\n  if (query.thumbnailUrl) {\r\n    thumbnailUrl.value = decodeURIComponent(query.thumbnailUrl);\r\n  }\r\n  if (query.duration) {\r\n    videoDuration.value = parseInt(query.duration) || 0;\r\n  }\r\n  if (query.size) {\r\n    videoSize.value = parseInt(query.size) || 0;\r\n  }\r\n  if (query.width) {\r\n    videoWidth.value = parseInt(query.width) || 0;\r\n  }\r\n  if (query.height) {\r\n    videoHeight.value = parseInt(query.height) || 0;\r\n  }\r\n  \r\n  // 创建视频上下文\r\n  videoContext.value = uni.createVideoContext('myVideo');\r\n  \r\n  // 自动隐藏控制栏\r\n  hideControlsAfterDelay();\r\n});\r\n\r\nonUnmounted(() => {\r\n  // 页面卸载时暂停视频\r\n  if (videoContext.value) {\r\n    videoContext.value.pause();\r\n  }\r\n  \r\n  // 清除定时器\r\n  if (controlsTimeout.value) {\r\n    clearTimeout(controlsTimeout.value);\r\n  }\r\n});\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  uni.navigateBack();\r\n};\r\n\r\n// 播放/暂停视频\r\nconst togglePlay = () => {\r\n  if (isPlaying.value) {\r\n    videoContext.value.pause();\r\n  } else {\r\n    videoContext.value.play();\r\n  }\r\n  isPlaying.value = !isPlaying.value;\r\n  \r\n  // 显示控制栏并设置自动隐藏\r\n  showControls.value = true;\r\n  hideControlsAfterDelay();\r\n};\r\n\r\n// 视频播放状态变化\r\nconst onPlay = () => {\r\n  isPlaying.value = true;\r\n};\r\n\r\n// 视频暂停状态变化\r\nconst onPause = () => {\r\n  isPlaying.value = false;\r\n};\r\n\r\n// 视频播放进度更新\r\nconst onTimeUpdate = (e) => {\r\n  currentTime.value = e.detail.currentTime;\r\n};\r\n\r\n// 点击视频区域\r\nconst onVideoClick = () => {\r\n  showControls.value = !showControls.value;\r\n  \r\n  if (showControls.value) {\r\n    hideControlsAfterDelay();\r\n  }\r\n};\r\n\r\n// 延迟隐藏控制栏\r\nconst hideControlsAfterDelay = () => {\r\n  if (controlsTimeout.value) {\r\n    clearTimeout(controlsTimeout.value);\r\n  }\r\n  \r\n  controlsTimeout.value = setTimeout(() => {\r\n    if (isPlaying.value) {\r\n      showControls.value = false;\r\n    }\r\n  }, 3000);\r\n};\r\n\r\n// 全屏播放\r\nconst fullScreen = () => {\r\n  videoContext.value.requestFullScreen({\r\n    direction: 0 // 0: 正常竖屏, 90: 横屏\r\n  });\r\n};\r\n\r\n// 视频加载错误处理\r\nconst onVideoError = (e) => {\r\n  console.error('视频加载错误:', e);\r\n  uni.showToast({\r\n    title: '视频加载失败',\r\n    icon: 'none'\r\n  });\r\n};\r\n</script>\r\n\r\n<template>\r\n  <view class=\"video-preview\" @click=\"onVideoClick\">\r\n    <!-- 顶部导航栏 -->\r\n    <view class=\"nav-bar\" v-if=\"showControls\">\r\n      <view class=\"back-btn\" @click.stop=\"goBack\">\r\n        <uni-icons type=\"back\" size=\"24\" color=\"#fff\"></uni-icons>\r\n      </view>\r\n      <text class=\"title\">视频预览</text>\r\n    </view>\r\n    \r\n    <!-- 视频播放区域 -->\r\n    <view class=\"video-container\">\r\n      <video \r\n        id=\"myVideo\"\r\n        :src=\"videoUrl\"\r\n        :poster=\"thumbnailUrl\"\r\n        :controls=\"false\"\r\n        :show-center-play-btn=\"false\"\r\n        object-fit=\"contain\"\r\n        class=\"video\"\r\n        @play=\"onPlay\"\r\n        @pause=\"onPause\"\r\n        @timeupdate=\"onTimeUpdate\"\r\n        @error=\"onVideoError\"\r\n      ></video>\r\n      \r\n      <!-- 自定义播放控制 -->\r\n      <view class=\"custom-controls\" v-if=\"showControls\">\r\n        <!-- 中央播放/暂停按钮 -->\r\n        <view class=\"center-play-btn\" @click.stop=\"togglePlay\">\r\n          <uni-icons :type=\"isPlaying ? 'pause-filled' : 'play-filled'\" size=\"50\" color=\"#fff\"></uni-icons>\r\n        </view>\r\n        \r\n        <!-- 底部控制栏 -->\r\n        <view class=\"bottom-controls\">\r\n          <!-- 播放时间信息 -->\r\n          <view class=\"time-info\">\r\n            <text class=\"current-time\">{{formattedCurrentTime}}</text>\r\n            <text class=\"time-separator\">/</text>\r\n            <text class=\"total-time\">{{formattedDuration}}</text>\r\n          </view>\r\n          \r\n          <!-- 全屏按钮 -->\r\n          <view class=\"fullscreen-btn\" @click.stop=\"fullScreen\">\r\n            <uni-icons type=\"arrow-right\" size=\"24\" color=\"#fff\"></uni-icons>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 视频信息 -->\r\n    <view class=\"video-info\" v-if=\"showControls\">\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">时长:</text>\r\n        <text class=\"info-value\">{{formattedDuration}}</text>\r\n      </view>\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">大小:</text>\r\n        <text class=\"info-value\">{{formattedSize}}</text>\r\n      </view>\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">分辨率:</text>\r\n        <text class=\"info-value\">{{resolution}}</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n.video-preview {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100vh;\r\n  background-color: #000;\r\n  \r\n  .nav-bar {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 88rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 0 30rpx;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    z-index: 10;\r\n    \r\n    .back-btn {\r\n      width: 60rpx;\r\n      height: 60rpx;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n    \r\n    .title {\r\n      flex: 1;\r\n      text-align: center;\r\n      color: #fff;\r\n      font-size: 32rpx;\r\n      margin-right: 60rpx;\r\n    }\r\n  }\r\n  \r\n  .video-container {\r\n    width: 100%;\r\n    height: 100%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    position: relative;\r\n    \r\n    .video {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    \r\n    .custom-controls {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      z-index: 5;\r\n      \r\n      .center-play-btn {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        width: 100rpx;\r\n        height: 100rpx;\r\n        background-color: rgba(0, 0, 0, 0.5);\r\n        border-radius: 50%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n      \r\n      .bottom-controls {\r\n        position: absolute;\r\n        bottom: 30rpx;\r\n        left: 0;\r\n        width: 100%;\r\n        padding: 0 30rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        \r\n        .time-info {\r\n          display: flex;\r\n          align-items: center;\r\n          color: #fff;\r\n          font-size: 24rpx;\r\n          \r\n          .time-separator {\r\n            margin: 0 5rpx;\r\n          }\r\n        }\r\n        \r\n        .fullscreen-btn {\r\n          width: 60rpx;\r\n          height: 60rpx;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  .video-info {\r\n    position: fixed;\r\n    bottom: 100rpx;\r\n    left: 0;\r\n    width: 100%;\r\n    padding: 20rpx 30rpx;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    z-index: 6;\r\n    \r\n    .info-item {\r\n      display: flex;\r\n      margin-bottom: 10rpx;\r\n      \r\n      &:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .info-label {\r\n        color: rgba(255, 255, 255, 0.8);\r\n        font-size: 24rpx;\r\n        width: 120rpx;\r\n      }\r\n      \r\n      .info-value {\r\n        color: #fff;\r\n        font-size: 24rpx;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style> ","import MiniProgramPage from 'E:/dy2/pages/video-preview/video-preview.vue'\ntt.createPage(MiniProgramPage)"],"names":["ref","computed","onMounted","uni","onUnmounted"],"mappings":"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"}