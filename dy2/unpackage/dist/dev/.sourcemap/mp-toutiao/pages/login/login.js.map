{"version":3,"file":"login.js","sources":["pages/login/login.vue","D:/代码测试/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport { useUserInfoStore } from '@/store/user.js'\r\n\t\r\n\tconst userStore = useUserInfoStore()\r\n\tconst dyLogin = uniCloud.importObject('userDy')\r\n\tconst modelShow = ref(false)\r\n\tconst code = ref()\r\n\tconst aloneChecked = ref(true)\r\n\t\r\n\t// 页面加载时自动勾选\r\n\tonMounted(() => {\r\n\t\taloneChecked.value = true\r\n\t})\r\n\t\r\n\tconst clickLogin = async () => {\r\n\t\t// 自动勾选协议\r\n\t\taloneChecked.value = true\r\n\t\t\r\n\t\t// 直接进行登录逻辑，不再需要协议检查\r\n\t\tconst res = await tt.login({\r\n\t\t\tsuccess(result) {\r\n\t\t\t\tcode.value = result.code\r\n\t\t\t\tmodelShow.value = true\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst closeModel = () => {\r\n\t\tmodelShow.value = false\r\n\t}\r\n\t\r\n\tconst navigateToAgreement = (type) => {\r\n\t\t// 处理协议跳转\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/agreement/${type}`\r\n\t\t})\r\n\t}\r\n\r\n\tconst getMobile = async (e) => {\r\n\t\tif (e.detail.errMsg !== 'getPhoneNumber:ok') {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '获取手机号失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\tconst params = {\r\n\t\t\tcode: code.value,\r\n\t\t\tencryptedData: e.detail.encryptedData,\r\n\t\t\tiv: e.detail.iv\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\t// 显示加载提示\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '登录中...',\r\n\t\t\t\tmask: true\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\tconst res = await dyLogin.loginByPhoneDy(params)\r\n\t\t\tconsole.log(res)\r\n\t\t\t\r\n\t\t\t// 隐藏加载提示\r\n\t\t\tuni.hideLoading()\r\n\t\t\t\r\n\t\t\tif (res.code === 0) {\r\n\t\t\t\t// 登录成功，保存用户信息\r\n\t\t\t\tuserStore.login({\r\n\t\t\t\t\tuid: res.data.uid || '',\r\n\t\t\t\t\tnickName: res.data.nickName || '',\r\n\t\t\t\t\tavatarUrl: res.data.avatarUrl || '/static/images/defalut.png',\r\n\t\t\t\t\tmobile: res.data.mobile || '',\r\n\t\t\t\t\trole: res.data.role || []\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '登录成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\t// 获取当前页面栈\r\n\t\t\t\tconst pages = getCurrentPages()\r\n\t\t\t\t\r\n\t\t\t\tif (pages.length > 1) {\r\n\t\t\t\t\t// 如果有上一页，延迟返回上一页\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\t\t\tdelta: 1,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tconsole.log('成功返回上一页')\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tconsole.error('返回上一页失败:', err)\r\n\t\t\t\t\t\t\t\t// 返回失败就跳转到首页\r\n\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 如果没有上一页（比如通过分享直接进入登录页），跳转到首页\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 触发全局登录成功事件，通知其他页面\r\n\t\t\t\tuni.$emit('loginSuccess', userStore.userInfo)\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.message || '登录失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error)\r\n\t\t\tuni.hideLoading()\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '登录失败，请稍后再试',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<template>\r\n\t<view class=\"loginPages\">\r\n\t\t<view class=\"bg\">\r\n\t\t</view>\r\n\t\t<!-- 标题 -->\r\n\t\t<view class=\"title\">\r\n\t\t\t<view class=\"logo\">\r\n\t\t\t\t<image src=\"/static/images/logo.png\" mode=\"aspectFit\"></image>\r\n\t\t\t</view>\r\n\t\t\t<!-- 提示词 -->\r\n\t\t\t<view class=\"wenben\">\r\n\t\t\t\t欢迎登录进行使用\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 隐私协议 -->\r\n\t\t<view class=\"authLogin\">\r\n\t\t\t<view class=\"agree\">\r\n\t\t\t\t<up-checkbox activeColor=\"#46b0fe\" class=\"checkbox\" name=\"agree\" usedAlone\r\n\t\t\t\t\tv-model:checked=\"aloneChecked\" shape=\"circle\">\r\n\t\t\t\t</up-checkbox>\r\n\t\t\t\t<view class=\"text-wrapper\">\r\n\t\t\t\t\t<text class=\"normal-text\">我已阅读并同意</text>\r\n\t\t\t\t\t<view class=\"link-text\" @click=\"navigateToAgreement('vipServer')\">\r\n\t\t\t\t\t\t服务协议\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text class=\"normal-text\">和</text>\r\n\t\t\t\t\t<view class=\"link-text\" @click=\"navigateToAgreement('privacyAgreement')\">\r\n\t\t\t\t\t\t隐私政策\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 登录按钮 -->\r\n\t\t\t<view class=\"login\">\r\n\t\t\t\t<button class=\"btn\" @click=\"clickLogin\">一键登录</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 手机号登录弹框 -->\r\n\t\t<view class=\"mobileLoginModel\" v-if=\"modelShow\">\r\n\t\t\t<view class=\"model\">\r\n\t\t\t\t<!-- 添加关闭按钮 -->\r\n\t\t\t\t<view class=\"close-btn\" @click=\"closeModel\">\r\n\t\t\t\t\t<text class=\"close-icon\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 图标区域 -->\r\n\t\t\t\t<view class=\"icon-wrapper\">\r\n\t\t\t\t\t<image class=\"default-avatar\" src=\"/static/images/defalut.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 文字区域 -->\r\n\t\t\t\t<view class=\"textValue\">\r\n\t\t\t\t\t<view class=\"titleModel\">\r\n\t\t\t\t\t\t登录确认\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"contentModel\">\r\n\t\t\t\t\t\t登录即表示同意服务协议和隐私政策\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- 按钮区域改动 -->\r\n\t\t\t\t<view class=\"caozuo\">\r\n\t\t\t\t\t<button class=\"confirm\" open-type=\"getPhoneNumber\" @getphonenumber=\"getMobile\">\r\n\t\t\t\t\t\t<text class=\"btn-text\">手机号一键登录</text>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.loginPages {\r\n\t\theight: 100vh;\r\n\t\tbackground: linear-gradient(to top, #ccd8f7, #fff);\r\n\r\n\t\t.bg {\r\n\t\t\tposition: fixed;\r\n\t\t\ttop: 0;\r\n\t\t\tleft: 0;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 600rpx;\r\n\t\t\tbackground: linear-gradient(to right, #ccd8f7, #fce1e2);\r\n\t\t\t-webkit-mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 30%, rgba(0, 0, 0, 0) 70%);\r\n\t\t\tmask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1) 30%, rgba(0, 0, 0, 0) 70%);\r\n\t\t}\r\n\r\n\t\t/*标题*/\r\n\t\t.title {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 50%;\r\n\t\t\ttop: 20%;\r\n\t\t\ttransform: translateX(-50%);\r\n\r\n\t\t\t.logo {\r\n\t\t\t\tmargin-bottom: 40rpx;\r\n\t\t\t\theight: 100rpx;\r\n\t\t\t\twidth: 400rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.wenben {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\tcolor: $pyq-text-color-body-secondary;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*授权登录*/\r\n\t\t.authLogin {\r\n\t\t\twidth: 100%;\r\n\r\n\t\t\t/*同意*/\r\n\t\t\t.agree {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding-top: 600rpx;\r\n\t\t\t\tmargin: auto;\r\n\t\t\t\twidth: fit-content;\r\n\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\tcolor: $pyq-text-color-helper;\r\n\r\n\t\t\t\t.checkbox {\r\n\t\t\t\t\tmargin-right: 8rpx;\r\n\t\t\t\t\t// 确保复选框始终显示为选中状态\r\n\t\t\t\t\t:deep(.u-checkbox__icon-wrap--checked) {\r\n\t\t\t\t\t\topacity: 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.text-wrapper {\r\n\t\t\t\t\tflex: 1;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tflex-wrap: wrap;\r\n\r\n\t\t\t\t\t.normal-text {\r\n\t\t\t\t\t\tfont-size: 24rpx;\r\n\t\t\t\t\t\tcolor: $pyq-text-color-helper;\r\n\t\t\t\t\t\tpadding: 0 4rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.link-text {\r\n\t\t\t\t\t\tcolor: $pyq-vi-color;\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tpadding: 4rpx 8rpx;\r\n\t\t\t\t\t\ttext-decoration: underline;\r\n\r\n\t\t\t\t\t\t&:active {\r\n\t\t\t\t\t\t\topacity: 0.7;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/*登录*/\r\n\t\t\t.login {\r\n\t\t\t\tpadding: 40rpx;\r\n\t\t\t\tbackground: rgba(0, 0, 0, 0);\r\n\r\n\t\t\t\t.btn {\r\n\t\t\t\t\tbackground-color: $pyq-vi-color;\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\tborder-radius: 64rpx;\r\n\t\t\t\t\twidth: 70%;\r\n\t\t\t\t\tmargin: 0 auto;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*授权弹框*/\r\n\t\t.mobileLoginModel {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 0;\r\n\t\t\ttop: 0;\r\n\t\t\theight: 100vh;\r\n\t\t\twidth: 100%;\r\n\t\t\tbackground: rgba(0, 0, 0, 0.2);\r\n\r\n\t\t\t.model {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\twidth: 560rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tborder-radius: 32rpx;\r\n\t\t\t\tmargin: 300rpx auto;\r\n\t\t\t\toverflow: hidden;\r\n\r\n\t\t\t\t// 添加关闭按钮样式\r\n\t\t\t\t.close-btn {\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tright: 20rpx;\r\n\t\t\t\t\ttop: 20rpx;\r\n\t\t\t\t\twidth: 90rpx;\r\n\t\t\t\t\theight: 90rpx;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tjustify-content: center;\r\n\r\n\t\t\t\t\t.close-icon {\r\n\t\t\t\t\t\tfont-size: 48rpx;\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t&:active {\r\n\t\t\t\t\t\topacity: 0.7;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.icon-wrapper {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\tpadding: 60rpx 0 20rpx;\r\n\r\n\t\t\t\t\t.default-avatar {\r\n\t\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t\t\tborder: 4rpx solid #f0f0f0;\r\n\t\t\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.textValue {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tpadding: 40rpx 40rpx 40rpx;\r\n\r\n\t\t\t\t\t.titleModel {\r\n\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\t\tcolor: $pyq-text-color-title;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.contentModel {\r\n\t\t\t\t\t\tmargin-top: 20rpx;\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: $pyq-text-color-helper;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/*按钮*/\r\n\t\t\t\t.caozuo {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tpadding: 0 40rpx 40rpx;\r\n\r\n\t\t\t\t\t.confirm {\r\n\t\t\t\t\t\tflex: 1;\r\n\t\t\t\t\t\theight: 88rpx;\r\n\t\t\t\t\t\tline-height: 88rpx;\r\n\t\t\t\t\t\tbackground-color: $pyq-vi-color;\r\n\t\t\t\t\t\tborder-radius: 44rpx;\r\n\t\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t\tborder: none;\r\n\r\n\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\tborder: none;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t.btn-text {\r\n\t\t\t\t\t\t\tfont-weight: 500;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t&:active {\r\n\t\t\t\t\t\t\topacity: 0.9;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/dy2/pages/login/login.vue'\ntt.createPage(MiniProgramPage)"],"names":["useUserInfoStore","uniCloud","ref","onMounted","uni"],"mappings":"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"}