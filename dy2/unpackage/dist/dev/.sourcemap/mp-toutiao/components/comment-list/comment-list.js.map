{"version":3,"file":"comment-list.js","sources":["components/comment-list/comment-list.vue","D:/代码测试/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovZHkyL2NvbXBvbmVudHMvY29tbWVudC1saXN0L2NvbW1lbnQtbGlzdC52dWU"],"sourcesContent":["<script setup>\n\timport { useUserInfoStore } from \"@/store/user.js\"\n\timport formatTime from '@/utils/formatTime.js'\n\tconst userInfoStore = useUserInfoStore( )\n\n\t// 定义组件属性\n\tconst props = defineProps( {\n\t\tcomments: {\n\t\t\ttype: Array,\n\t\t\tdefault: ( ) => [ ]\n\t\t},\n\t\tarticleId: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tarticleUserId: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tshowMobile: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t}\n\t} )\n\n\t// 定义事件\n\tconst emit = defineEmits( [ 'update:comments', 'reply', 'delComment' ] )\n\n\t// 判断是否是自己的评论\n\tconst isOwnComment = ( comment ) => {\n\t\treturn comment.user_id === userInfoStore.userInfo.uid\n\t}\n\n\t// 处理评论点击\n\tconst handleCommentClick = ( comment ) => {\n\t\tconsole.log( comment )\n\t\t// 如果是自己的评论，不做任何响应\n\t\tif ( isOwnComment( comment ) ) return\n\n\t\t// 如果是别人的评论，触发回复事件\n\t\temit( 'reply', comment )\n\t}\n\n\t// 处理删除评论\n\tconst handleDeleteComment = ( commentId ) => {\n\t\temit( 'delComment', commentId )\n\t}\n\t\n\t// 判断是否是帖子发布者\n\tconst isPostAuthor = () => {\n\t\t// 确保当前用户已登录\n\t\tif (!userInfoStore.userInfo || !userInfoStore.userInfo.uid) {\n\t\t\treturn false\n\t\t}\n\t\t\n\t\t// 确保articleUserId存在\n\t\tif (!props.articleUserId) {\n\t\t\treturn false\n\t\t}\n\t\t\n\t\t// 检查当前用户是否是帖子的发布者\n\t\treturn userInfoStore.userInfo.uid === props.articleUserId\n\t}\n\t\n\t// 处理拨打电话\n\tconst handleCallPhone = (mobile) => {\n\t\t// 只有帖子发布者才能拨打电话\n\t\tif (!isPostAuthor()) {\n\t\t\treturn\n\t\t}\n\t\t\n\t\t// 拨打电话前确认\n\t\tuni.showModal({\n\t\t\ttitle: '拨打电话',\n\t\t\tcontent: `确定要拨打 ${mobile} 吗？`,\n\t\t\tsuccess: (res) => {\n\t\t\t\tif (res.confirm) {\n\t\t\t\t\tuni.makePhoneCall({\n\t\t\t\t\t\tphoneNumber: mobile,\n\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '拨打电话失败',\n\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\t// 格式化手机号，隐藏中间4位\n\tconst formatMobile = (mobile) => {\n\t\tif (!mobile || mobile.length < 7) return mobile\n\t\t\n\t\t// 标准手机号处理 (例如：138****1234)\n\t\tif (mobile.length === 11) {\n\t\t\treturn mobile.substring(0, 3) + '****' + mobile.substring(7)\n\t\t}\n\t\t\n\t\t// 其他格式的号码，简单处理\n\t\tconst start = Math.floor(mobile.length / 3)\n\t\tconst end = mobile.length - start\n\t\treturn mobile.substring(0, start) + '****' + mobile.substring(end)\n\t}\n</script>\n\n<template>\n\t<view class=\"comment-list\">\n\t\t<view class=\"debug-panel\" v-if=\"false\">\n\t\t\t调试信息: showMobile={{showMobile}} | articleUserId={{articleUserId}} | \n\t\t\t当前用户={{userInfoStore.userInfo?.uid}}\n\t\t</view>\n\t\t\n\t\t<view v-for=\"(comment,index) in comments\" :key=\"index\" class=\"comment-item\">\n\t\t\t<!-- 用户头像 -->\n\t\t\t<image class=\"avatar\" :src=\"comment.avatarUrl\" mode=\"aspectFill\"></image>\n\n\t\t\t<view class=\"comment-content\" @click=\"handleCommentClick(comment)\"\n\t\t\t\t:class=\"{ 'own-comment': isOwnComment(comment) }\">\n\t\t\t\t<!-- 用户名和时间 -->\n\t\t\t\t<view class=\"comment-header\">\n\t\t\t\t\t<view class=\"user-info\">\n\t\t\t\t\t\t<view class=\"name-container\">\n\t\t\t\t\t\t\t<text class=\"username\">{{comment.nickName}}</text>\n\t\t\t\t\t\t\t<!-- 手机号显示在昵称后面 - 仅对帖子发布者显示 -->\n\t\t\t\t\t\t\t<view class=\"mobile-badge clickable\" \n\t\t\t\t\t\t\t\tv-if=\"showMobile && comment.mobile && isPostAuthor()\" \n\t\t\t\t\t\t\t\t@click.stop=\"handleCallPhone(comment.mobile)\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<uni-icons type=\"phone\" size=\"11\" color=\"#399bfe\"></uni-icons>\n\t\t\t\t\t\t\t\t<text>{{formatMobile(comment.mobile)}}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"time-action\">\n\t\t\t\t\t\t<!-- 显示删除按钮（自己的评论或文章作者） -->\n\t\t\t\t\t\t<view \n\t\t\t\t\t\t\tv-if=\"isOwnComment(comment)\" \n\t\t\t\t\t\t\tclass=\"delete-btn\"\n\t\t\t\t\t\t\t@click.stop=\"handleDeleteComment(comment._id)\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<uni-icons \n\t\t\t\t\t\t\t\tcustom-prefix=\"iconfont\" \n\t\t\t\t\t\t\t\ttype=\"icon-shanchu1\" \n\t\t\t\t\t\t\t\tsize=\"16\" \n\t\t\t\t\t\t\t\tcolor=\"#999\"\n\t\t\t\t\t\t\t></uni-icons>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\n\t\t\t\t<!-- 评论内容 -->\n\t\t\t\t<view class=\"comment-text\">\n\t\t\t\t\t<!-- 如果是回复其他评论 -->\n\t\t\t\t\t<template v-if=\"comment.reply_to\">\n\t\t\t\t\t\t<text class=\"reply-text\">回复</text>\n\t\t\t\t\t\t<text class=\"reply-name\">{{comment.reply_to.nickName}}</text>\n\t\t\t\t\t</template>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"content-time-wrapper\">\n\t\t\t\t\t\t<view class=\"comment-text-container\">\n\t\t\t\t\t\t\t<text class=\"content\">{{comment.content}}</text>\n\t\t\t\t\t\t\t<text class=\"time\">{{formatTime(comment.create_time)}}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 评论底部区域取消 -->\n\t\t\t\t<view class=\"comment-footer\" style=\"display: none;\">\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<style lang=\"scss\" scoped>\n\t/*评论列表*/\n\t.comment-list {\n\t\tpadding: 0 24rpx;\n\n\t\t.comment-item {\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-start;\n\t\t\tpadding: 24rpx 0;\n\t\t\tborder-bottom: 1px solid #f5f5f5;\n\n\t\t\t.avatar {\n\t\t\t\twidth: 64rpx;\n\t\t\t\theight: 64rpx;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t\tmargin-right: 16rpx;\n\t\t\t\tbackground-color: #f5f5f5;\n\t\t\t}\n\n\t\t\t.comment-content {\n\t\t\t\tposition: relative;\n\t\t\t\tflex: 1;\n\n\t\t\t\t&:active:not(.own-comment) {\n\t\t\t\t\topacity: 0.7;\n\t\t\t\t}\n\n\t\t\t\t&.own-comment {\n\t\t\t\t\tcursor: default;\n\t\t\t\t}\n\n\t\t\t\t.comment-header {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: space-between;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tmargin-bottom: 12rpx;\n\t\t\t\t\t\n\t\t\t\t\t.user-info {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.name-container {\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.username {\n\t\t\t\t\t\t\tcolor: $pyq-vi-color;\n\t\t\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.mobile-badge {\n\t\t\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tfont-size: 20rpx;\n\t\t\t\t\t\t\tcolor: #399bfe;\n\t\t\t\t\t\t\tmargin-left: 8rpx;\n\t\t\t\t\t\t\tpadding: 0 6rpx;\n\t\t\t\t\t\t\tborder-radius: 4rpx;\n\t\t\t\t\t\t\tmax-width: 140rpx;\n\t\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\t\t\tborder: 1px solid rgba(57, 155, 254, 0.2);\n\t\t\t\t\t\t\tbackground-color: rgba(57, 155, 254, 0.05);\n\t\t\t\t\t\t\theight: 28rpx;\n\t\t\t\t\t\t\tvertical-align: middle;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t&.clickable {\n\t\t\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t&:active {\n\t\t\t\t\t\t\t\t\topacity: 0.7;\n\t\t\t\t\t\t\t\t\tbackground-color: rgba(57, 155, 254, 0.1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttext {\n\t\t\t\t\t\t\t\tmargin-left: 2rpx;\n\t\t\t\t\t\t\t\tfont-size: 18rpx;\n\t\t\t\t\t\t\t\ttransform-origin: left center;\n\t\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\t\tline-height: 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tuni-icons {\n\t\t\t\t\t\t\t\ttransform: scale(0.85);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t.time-action {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: flex-end;\n\n\t\t\t\t\t\t.delete-btn {\n\t\t\t\t\t\t\tpadding: 4rpx 12rpx;\n\t\t\t\t\t\t\tmargin-left: auto;\n\t\t\t\t\t\t\tbackground-color: #f8f8f8;\n\t\t\t\t\t\t\tborder-radius: 20rpx;\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t&::after {\n\t\t\t\t\t\t\t\tcontent: \"删除\";\n\t\t\t\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\t\t\t\tcolor: #666;\n\t\t\t\t\t\t\t\tmargin-left: 4rpx;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t&:active {\n\t\t\t\t\t\t\t\tbackground-color: #eeeeee;\n\t\t\t\t\t\t\t\topacity: 0.8;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.comment-text {\n\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\tcolor: $pyq-text-color-body;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\t\n\t\t\t\t\t.reply-text {\n\t\t\t\t\t\tcolor: $pyq-text-color-helper;\n\t\t\t\t\t\tmargin: 0 8rpx;\n\t\t\t\t\t}\n\n\t\t\t\t\t.reply-name {\n\t\t\t\t\t\tcolor: $pyq-vi-color;\n\t\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\t}\n\n\t\t\t\t\t.content-time-wrapper {\n\t\t\t\t\t\tmargin-top: 4rpx;\n\t\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\t\tmargin-left: 8rpx;\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.comment-text-container {\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.content {\n\t\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\t\tcolor: $pyq-text-color-body;\n\t\t\t\t\t\t\tword-break: break-all;\n\t\t\t\t\t\t\twhite-space: pre-wrap;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t.time {\n\t\t\t\t\t\t\tfont-size: 22rpx;\n\t\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t\t\tmargin-left: 8rpx;\n\t\t\t\t\t\t\tvertical-align: baseline;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.comment-footer {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tjustify-content: flex-end;\n\t\t\t\t\tmargin-top: 16rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</style>","import Component from 'E:/dy2/components/comment-list/comment-list.vue'\ntt.createComponent(Component)"],"names":["useUserInfoStore","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGC,UAAM,gBAAgBA,WAAAA,iBAAmB;AAGzC,UAAM,QAAQ;AAoBd,UAAM,OAAO;AAGb,UAAM,eAAe,CAAE,YAAa;AACnC,aAAO,QAAQ,YAAY,cAAc,SAAS;AAAA,IAClD;AAGD,UAAM,qBAAqB,CAAE,YAAa;AACzCC,oBAAAA,MAAY,MAAA,OAAA,kDAAC,OAAS;AAEtB,UAAK,aAAc,OAAO;AAAK;AAG/B,WAAM,SAAS,OAAS;AAAA,IACxB;AAGD,UAAM,sBAAsB,CAAE,cAAe;AAC5C,WAAM,cAAc,SAAW;AAAA,IAC/B;AAGD,UAAM,eAAe,MAAM;AAE1B,UAAI,CAAC,cAAc,YAAY,CAAC,cAAc,SAAS,KAAK;AAC3D,eAAO;AAAA,MACP;AAGD,UAAI,CAAC,MAAM,eAAe;AACzB,eAAO;AAAA,MACP;AAGD,aAAO,cAAc,SAAS,QAAQ,MAAM;AAAA,IAC5C;AAGD,UAAM,kBAAkB,CAAC,WAAW;AAEnC,UAAI,CAAC,aAAY,GAAI;AACpB;AAAA,MACA;AAGDA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,SAAS,MAAM;AAAA,QACxB,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChBA,0BAAAA,MAAI,cAAc;AAAA,cACjB,aAAa;AAAA,cACb,MAAM,CAAC,QAAQ;AACdA,8BAAAA,MAAI,UAAU;AAAA,kBACb,OAAO;AAAA,kBACP,MAAM;AAAA,gBACd,CAAQ;AAAA,cACD;AAAA,YACP,CAAM;AAAA,UACD;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAGD,UAAM,eAAe,CAAC,WAAW;AAChC,UAAI,CAAC,UAAU,OAAO,SAAS;AAAG,eAAO;AAGzC,UAAI,OAAO,WAAW,IAAI;AACzB,eAAO,OAAO,UAAU,GAAG,CAAC,IAAI,SAAS,OAAO,UAAU,CAAC;AAAA,MAC3D;AAGD,YAAM,QAAQ,KAAK,MAAM,OAAO,SAAS,CAAC;AAC1C,YAAM,MAAM,OAAO,SAAS;AAC5B,aAAO,OAAO,UAAU,GAAG,KAAK,IAAI,SAAS,OAAO,UAAU,GAAG;AAAA,IACjE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvGF,GAAG,gBAAgB,SAAS;"}