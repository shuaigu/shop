{"version":3,"file":"tuijian.js","sources":["components/tuijian/tuijian.vue","D:/代码测试/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovZHkyL2NvbXBvbmVudHMvdHVpamlhbi90dWlqaWFuLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"more-articles\">\n\t\t<view class=\"section-divider\"></view>\n\t\t<view class=\"section-title\">\n\t\t\t{{ cate_id ? '相关推荐' : '更多文章' }}\n\t\t</view>\n\t\t\n\t\t<!-- 文章列表 -->\n\t\t<view v-if=\"articles.length > 0\" class=\"article-list\">\n\t\t\t<view \n\t\t\t\tv-for=\"item in articles\" \n\t\t\t\t:key=\"item._id\" \n\t\t\t\tclass=\"article-item\"\n\t\t\t\t@click=\"handleArticleClick(item._id)\"\n\t\t\t>\n\t\t\t\t<view class=\"article-content\">\n\t\t\t\t\t<!-- 左侧图片部分 -->\n\t\t\t\t\t<view class=\"image-wrapper\">\n\t\t\t\t\t\t<image \n\t\t\t\t\t\t\tclass=\"article-image\"\n\t\t\t\t\t\t\t:src=\"item.images && item.images.length ? item.images[0].compressedURL : (item.category_image || '/static/images/default-image.png')\" \n\t\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t\t\t@click.stop=\"item.images && item.images.length ? handleImagePreview(item.images) : null\"\n\t\t\t\t\t\t></image>\n\t\t\t\t\t\t<!-- 添加图片计数器，当有多张图片时显示 -->\n\t\t\t\t\t\t<view class=\"image-counter\" v-if=\"item.images && item.images.length > 1\">\n\t\t\t\t\t\t\t<uni-icons type=\"image\" size=\"12\" color=\"#fff\"></uni-icons>\n\t\t\t\t\t\t\t<text class=\"counter-text\">{{item.images.length}}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 右侧文字部分 -->\n\t\t\t\t\t<view class=\"text-content\">\n\t\t\t\t\t\t<view class=\"content-preview\">\n\t\t\t\t\t\t\t<text class=\"category-name\">{{item.cate_name || '未分类'}}</text>丨{{item.content}}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"info\">\n\t\t\t\t\t\t\t<text class=\"time\">{{formatTime(item.create_time)}}</text>\n\t\t\t\t\t\t\t<text class=\"views\">{{item.look_count || 0}}次浏览</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 加载状态 -->\n\t\t<view class=\"load-more-wrapper\">\n\t\t\t<uni-load-more \n\t\t\t\t:status=\"isLoadingMore ? 'loading' : loadMoreStatus\"\n\t\t\t\t:contentText=\"{\n\t\t\t\t\tcontentdown: '上拉加载更多',\n\t\t\t\t\tcontentrefresh: '加载中...',\n\t\t\t\t\tcontentnomore: cate_id ? '没有更多相关文章了' : '没有更多文章了'\n\t\t\t\t}\"\n\t\t\t\ticonType=\"auto\"\n\t\t\t\tcolor=\"#cccccc\"\n\t\t\t/>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch } from 'vue'\nimport formatTime from '@/utils/formatTime.js'\n\n// 定义组件的props\nconst props = defineProps({\n\t// 当前文章ID\n\tcurrentArticleId: {\n\t\ttype: String,\n\t\trequired: true\n\t},\n\t// 分类ID\n\tcate_id: {\n\t\ttype: String,\n\t\tdefault: ''\n\t}\n})\n\n// 定义事件\nconst emit = defineEmits(['click'])\n\n// 状态变量\nconst articles = ref([])\nconst pageNo = ref(1)\nconst pageSize = ref(8)\nconst isLoadingMore = ref(false)\nconst loadMoreStatus = ref('more')\nconst articleApi = uniCloud.importObject('articleDy', { customUI: true })\nconst cateApi = uniCloud.importObject('cateWx', { customUI: true })\n\n// 获取分类名称\nconst getCategoryName = async (cateId) => {\n\ttry {\n\t\tif (!cateId) return '未分类'\n\t\tconst res = await cateApi.get(cateId)\n\t\treturn res.data && res.data[0] ? res.data[0].cate_name : '未分类'\n\t} catch (err) {\n\t\tconsole.error('获取分类名称失败:', err)\n\t\treturn '未分类'\n\t}\n}\n\n// 获取分类图片\nconst getCategoryImage = async (cateId) => {\n\ttry {\n\t\tif (!cateId) return '/static/images/default-image.png'\n\t\tconst res = await cateApi.get(cateId)\n\t\treturn res.data && res.data[0] && res.data[0].cate_img ? res.data[0].cate_img : '/static/images/default-image.png'\n\t} catch (err) {\n\t\tconsole.error('获取分类图片失败:', err)\n\t\treturn '/static/images/default-image.png'\n\t}\n}\n\n// 获取更多文章\nconst getMoreArticles = async (refresh = false) => {\n\ttry {\n\t\tif (refresh) {\n\t\t\tpageNo.value = 1\n\t\t\tloadMoreStatus.value = 'loading'\n\t\t}\n\t\t\n\t\tisLoadingMore.value = true\n\t\t\n\t\t// 使用分类ID获取相关文章\n\t\tconst res = await articleApi.getArticle(\n\t\t\tprops.cate_id || '01', // 如果没有分类ID，则获取最新文章\n\t\t\tpageNo.value, \n\t\t\tpageSize.value\n\t\t)\n\t\t\n\t\tif (res.code === 0 && res.data) {\n\t\t\t// 过滤掉当前文章\n\t\t\tconst filteredData = res.data.filter(item => item._id !== props.currentArticleId)\n\t\t\t\n\t\t\t// 为每篇文章获取分类名称和分类图片\n\t\t\tconst articlesWithCategory = await Promise.all(\n\t\t\t\tfilteredData.map(async (article) => {\n\t\t\t\t\tif (!article.cate_name) {\n\t\t\t\t\t\tarticle.cate_name = await getCategoryName(article.cate_id)\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 如果文章没有图片，获取分类图片作为默认图片\n\t\t\t\t\tif (!article.images || article.images.length === 0) {\n\t\t\t\t\t\tarticle.category_image = await getCategoryImage(article.cate_id)\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn article\n\t\t\t\t})\n\t\t\t)\n\t\t\t\n\t\t\t// 更新文章列表\n\t\t\tif (refresh || pageNo.value === 1) {\n\t\t\t\tarticles.value = articlesWithCategory\n\t\t\t} else {\n\t\t\t\tarticles.value = [...articles.value, ...articlesWithCategory]\n\t\t\t}\n\t\t\t\n\t\t\t// 设置加载状态\n\t\t\tif (filteredData.length === 0) {\n\t\t\t\tloadMoreStatus.value = 'noMore'\n\t\t\t} else if (filteredData.length < pageSize.value && pageNo.value > 1) {\n\t\t\t\tloadMoreStatus.value = 'noMore'\n\t\t\t} else {\n\t\t\t\tloadMoreStatus.value = 'more'\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new Error(res.message || '获取更多文章失败')\n\t\t}\n\t} catch (err) {\n\t\tconsole.error('获取更多文章失败:', err)\n\t\tloadMoreStatus.value = 'more'\n\t} finally {\n\t\tisLoadingMore.value = false\n\t}\n}\n\n// 加载更多文章\nconst loadMore = async () => {\n\tif (isLoadingMore.value || loadMoreStatus.value === 'noMore') return\n\t\n\tpageNo.value++\n\tawait getMoreArticles(false)\n}\n\n// 处理文章点击\nconst handleArticleClick = (articleId) => {\n\temit('click', articleId)\n}\n\n// 处理图片预览\nconst handleImagePreview = (images) => {\n\tif (!images || !images.length) return\n\t\n\t// 提取所有图片的URL\n\tconst urls = images.map(img => img.compressedURL)\n\t\n\tuni.previewImage({\n\t\tcurrent: urls[0], // 默认显示第一张\n\t\turls: urls,\n\t\tindicator: 'number',\n\t\tloop: true,\n\t\tfail: (err) => {\n\t\t\tconsole.error('预览图片失败:', err)\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '预览图片失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t})\n}\n\n// 监听分类ID变化\nwatch(() => props.cate_id, (newVal, oldVal) => {\n\tif (newVal !== oldVal) {\n\t\tgetMoreArticles(true)\n\t}\n})\n\n// 组件挂载时获取数据\nonMounted(() => {\n\tgetMoreArticles(true)\n})\n\n// 暴露方法给父组件\ndefineExpose({\n\tloadMore,\n\trefresh: () => getMoreArticles(true)\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.more-articles {\n\tmargin-top: 32rpx;\n\tpadding: 0 24rpx;\n\tbackground-color: #fff;\n\t\n\t.section-divider {\n\t\theight: 16rpx;\n\t\tbackground-color: #f5f5f5;\n\t\tmargin: 0 -24rpx;\n\t}\n\t\n\t.section-title {\n\t\tfont-size: 32rpx;\n\t\tfont-weight: 500;\n\t\tcolor: #333;\n\t\tmargin: 32rpx 0 16rpx;\n\t}\n\t\n\t.article-list {\n\t\t.article-item {\n\t\t\tpadding: 24rpx;\n\t\t\tbackground: #fff;\n\t\t\tborder-radius: 12rpx;\n\t\t\tmargin-bottom: 24rpx;\n\t\t\tborder-bottom: 1px solid #eee;\n\t\t\t\n\t\t\t&:last-child {\n\t\t\t\tborder-bottom: none;\n\t\t\t}\n\t\t\t\n\t\t\t.article-content {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: flex-start;\n\t\t\t\t\n\t\t\t\t.image-wrapper {\n\t\t\t\t\twidth: 200rpx;\n\t\t\t\t\theight: 150rpx;\n\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\tmargin-right: 24rpx;\n\t\t\t\t\tbackground-color: #f5f5f5;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\t\n\t\t\t\t\t.article-image {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.image-counter {\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tright: 8rpx;\n\t\t\t\t\t\tbottom: 8rpx;\n\t\t\t\t\t\tbackground-color: rgba(0, 0, 0, 0.6);\n\t\t\t\t\t\tcolor: #fff;\n\t\t\t\t\t\tpadding: 4rpx 10rpx;\n\t\t\t\t\t\tborder-radius: 12rpx;\n\t\t\t\t\t\tfont-size: 20rpx;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tz-index: 2;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.counter-text {\n\t\t\t\t\t\t\tmargin-left: 4rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.text-content {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\t\n\t\t\t\t\t.content-preview {\n\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\tcolor: #666;\n\t\t\t\t\t\tline-height: 1.6;\n\t\t\t\t\t\tmargin-bottom: 16rpx;\n\t\t\t\t\t\tdisplay: -webkit-box;\n\t\t\t\t\t\t-webkit-box-orient: vertical;\n\t\t\t\t\t\t-webkit-line-clamp: 2;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.category-name {\n\t\t\t\t\t\t\tcolor: #399bfe;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t.info {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.time {\n\t\t\t\t\t\t\tmargin-right: 24rpx;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// 添加过渡动画\n\t\t\ttransition: transform 0.2s ease;\n\t\t\t\n\t\t\t&:active {\n\t\t\t\ttransform: scale(0.98);\n\t\t\t\tbackground-color: #f8f8f8;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.load-more-wrapper {\n\tpadding: 20rpx 0;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n</style>","import Component from 'E:/dy2/components/tuijian/tuijian.vue'\ntt.createComponent(Component)"],"names":["ref","uniCloud","uni","watch","onMounted"],"mappings":"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"}