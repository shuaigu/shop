{"version":3,"file":"api.js","sources":["utils/api.js"],"sourcesContent":["import { BASE_URL } from './config.js';\r\n\r\n// 抖音小程序 API 服务\r\nconst dyAPI = {\r\n  // 获取抖音小程序 OpenID 和 SessionKey\r\n  getOpenID(code, anonymousCode) {\r\n    return new Promise((resolve, reject) => {\r\n      uni.request({\r\n        url: `${BASE_URL}/api/toutiao/code2session`,\r\n        method: 'POST',\r\n        data: {\r\n          code,\r\n          anonymousCode\r\n        },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data.code === 0) {\r\n            resolve(res.data.data);\r\n          } else {\r\n            reject(res.data || { message: '获取OpenID失败' });\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  },\r\n  \r\n  // 解密用户手机号\r\n  decryptPhoneNumber(data) {\r\n    return new Promise((resolve, reject) => {\r\n      uni.request({\r\n        url: `${BASE_URL}/api/toutiao/decrypt_phone`,\r\n        method: 'POST',\r\n        data: {\r\n          sessionKey: data.sessionKey,\r\n          encryptedData: data.encryptedData,\r\n          iv: data.iv\r\n        },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data.code === 0) {\r\n            resolve(res.data.data);\r\n          } else {\r\n            reject(res.data || { message: '解密手机号失败' });\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  },\r\n  \r\n  // 用户登录（通过手机号）\r\n  login(phone, code) {\r\n    return new Promise((resolve, reject) => {\r\n      uni.request({\r\n        url: `${BASE_URL}/api/user/login`,\r\n        method: 'POST',\r\n        data: {\r\n          phone,\r\n          code,\r\n          platform: 'toutiao'\r\n        },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data.code === 0) {\r\n            // 保存登录状态和Token\r\n            uni.setStorageSync('token', res.data.data.token);\r\n            uni.setStorageSync('userInfo', res.data.data.userInfo);\r\n            resolve(res.data.data);\r\n          } else {\r\n            reject(res.data || { message: '登录失败' });\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport default {\r\n  dy: dyAPI\r\n}; "],"names":["uni","BASE_URL"],"mappings":";;;AAGA,MAAM,QAAQ;AAAA;AAAA,EAEZ,UAAU,MAAM,eAAe;AAC7B,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK,GAAGC,aAAQ,QAAA;AAAA,QAChB,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ;AAAA,UACA;AAAA,QACD;AAAA,QACD,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,KAAK,SAAS,GAAG;AACjD,oBAAQ,IAAI,KAAK,IAAI;AAAA,UACjC,OAAiB;AACL,mBAAO,IAAI,QAAQ,EAAE,SAAS,aAAc,CAAA;AAAA,UAC7C;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACb,iBAAO,GAAG;AAAA,QACX;AAAA,MACT,CAAO;AAAA,IACP,CAAK;AAAA,EACF;AAAA;AAAA,EAGD,mBAAmB,MAAM;AACvB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCD,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK,GAAGC,aAAQ,QAAA;AAAA,QAChB,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,YAAY,KAAK;AAAA,UACjB,eAAe,KAAK;AAAA,UACpB,IAAI,KAAK;AAAA,QACV;AAAA,QACD,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,KAAK,SAAS,GAAG;AACjD,oBAAQ,IAAI,KAAK,IAAI;AAAA,UACjC,OAAiB;AACL,mBAAO,IAAI,QAAQ,EAAE,SAAS,UAAW,CAAA;AAAA,UAC1C;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACb,iBAAO,GAAG;AAAA,QACX;AAAA,MACT,CAAO;AAAA,IACP,CAAK;AAAA,EACF;AAAA;AAAA,EAGD,MAAM,OAAO,MAAM;AACjB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCD,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK,GAAGC,aAAQ,QAAA;AAAA,QAChB,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ;AAAA,UACA;AAAA,UACA,UAAU;AAAA,QACX;AAAA,QACD,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,KAAK,SAAS,GAAG;AAEjDD,0BAAG,MAAC,eAAe,SAAS,IAAI,KAAK,KAAK,KAAK;AAC/CA,0BAAG,MAAC,eAAe,YAAY,IAAI,KAAK,KAAK,QAAQ;AACrD,oBAAQ,IAAI,KAAK,IAAI;AAAA,UACjC,OAAiB;AACL,mBAAO,IAAI,QAAQ,EAAE,SAAS,OAAQ,CAAA;AAAA,UACvC;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACb,iBAAO,GAAG;AAAA,QACX;AAAA,MACT,CAAO;AAAA,IACP,CAAK;AAAA,EACF;AACH;AAEA,MAAe,MAAA;AAAA,EACb,IAAI;AACN;;"}