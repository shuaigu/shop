{"version":3,"sources":["components/articleItem/articleItem.vue","D:/代码测试/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovZHkyL2NvbXBvbmVudHMvYXJ0aWNsZUl0ZW0vYXJ0aWNsZUl0ZW0udnVl"],"names":[],"mappings":"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","file":"components/articleItem/articleItem.js","sourcesContent":["<script setup>\n\timport { ref, watch, computed, onUnmounted, onMounted } from 'vue'\n\timport { useUserInfoStore } from '@/store/user.js'\n\tconst userStore = useUserInfoStore( )\n\n\t// 抖音小程序判断\n\tconst isToutiao = ref(false)\n\t\n\t// 在组件挂载时检测平台\n\tonMounted(() => {\n\t\t// #ifdef MP-TOUTIAO\n\t\tisToutiao.value = true\n\t\tconsole.log('运行在抖音小程序环境')\n\t\t// #endif\n\t})\n\n\t// 定义组件属性\n\tconst props = defineProps( {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequire: true,\n\t\t\tdefault: ( ) => ( {\n\t\t\t\tuser_info: {\n\t\t\t\t\tnickName: '未知用户',\n\t\t\t\t\tavatarUrl: '/static/images/default-avatar.png',\n\t\t\t\t\tmobile: '未填写'\n\t\t\t\t}\n\t\t\t} )\n\t\t},\n\t\t// 是否显示评论区\n\t\tshowComments: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\t// 是否启用头像点击功能\n\t\tavatarClickEnabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true\n\t\t}\n\t} )\n\n\t// 视频默认缩略图\n\tconst defaultVideoThumbnail = '/static/images/video-thumbnail.png'\n\t\n\t// 获取视频缩略图\n\tconst getVideoThumbnail = (video) => {\n\t\tif (!video) return defaultVideoThumbnail\n\t\t\n\t\tif (video.thumbnailURL) {\n\t\t\treturn video.thumbnailURL\n\t\t}\n\t\t\n\t\treturn defaultVideoThumbnail\n\t}\n\n\t// 自定义格式化日期函数\n\tconst formatDate = (timestamp) => {\n\t\tif (!timestamp) return '未知时间'\n\t\t\n\t\tconst now = Date.now()\n\t\tconst diff = now - timestamp\n\t\t\n\t\t// 转换为秒\n\t\tconst seconds = Math.floor(diff / 1000)\n\t\t// 转换为分钟\n\t\tconst minutes = Math.floor(seconds / 60)\n\t\t// 转换为小时\n\t\tconst hours = Math.floor(minutes / 60)\n\t\t// 转换为天\n\t\tconst days = Math.floor(hours / 24)\n\t\t\n\t\t// 刚刚\n\t\tif (seconds < 60) {\n\t\t\treturn '刚刚'\n\t\t}\n\t\t// xx分钟前\n\t\telse if (minutes < 60) {\n\t\t\treturn `${minutes}分钟前`\n\t\t}\n\t\t// xx小时前\n\t\telse if (hours < 24) {\n\t\t\treturn `${hours}小时前`\n\t\t}\n\t\t// xx天前 (最多显示180天)\n\t\telse if (days < 180) {\n\t\t\treturn `${days}天前`\n\t\t}\n\t\t// 具体日期\n\t\telse {\n\t\t\tconst date = new Date(timestamp)\n\t\t\tconst year = date.getFullYear()\n\t\t\tconst month = date.getMonth() + 1\n\t\t\tconst day = date.getDate()\n\t\t\tconst hour = date.getHours()\n\t\t\tconst minute = date.getMinutes()\n\t\t\t\n\t\t\t// 格式化为两位数\n\t\t\tconst formattedMonth = month < 10 ? `0${month}` : month\n\t\t\tconst formattedDay = day < 10 ? `0${day}` : day\n\t\t\tconst formattedHour = hour < 10 ? `0${hour}` : hour\n\t\t\tconst formattedMinute = minute < 10 ? `0${minute}` : minute\n\t\t\tconst timeStr = `${formattedHour}:${formattedMinute}`\n\t\t\t\n\t\t\t// 如果是今年，只显示月日时分\n\t\t\tconst nowYear = new Date().getFullYear()\n\t\t\tif (year === nowYear) {\n\t\t\t\treturn `${formattedMonth}月${formattedDay}日 ${timeStr}`\n\t\t\t}\n\t\t\t// 如果不是今年，显示年月日时分\n\t\t\treturn `${year}年${formattedMonth}月${formattedDay}日 ${timeStr}`\n\t\t}\n\t}\n\n\t// 定义事件\n\tconst emit = defineEmits( [ 'delete', 'contact', 'comment', 'like', 'preview', 'userList',\n\t\t'update:comments'\n\t] )\n\n\t// 处理用户列表点击\n\tconst handleUserList = ( user_id ) => {\n\t\t// 检查头像点击功能是否启用\n\t\tif (!props.avatarClickEnabled) {\n\t\t\tconsole.log('头像点击功能已禁用')\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '此功能开发中',\n\t\t\t\ticon: 'none',\n\t\t\t\tduration: 2000\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\t\n\t\temit( 'userList', user_id )\n\t}\n\n\t// 处理删除\n\tconst handleDelete = ( id ) => {\n\t\temit( 'delete', id )\n\t}\n\n\t// 处理联系\n\tconst handleContact = ( mobile ) => {\n\t\temit( 'contact', mobile )\n\t}\n\n\t// 处理评论\n\tconst handleComment = ( id ) => {\n\t\tif ( props.showComments ) {\n\t\t\t// 在详情页中，触发评论事件\n\t\t\temit( 'comment' )\n\t\t} else {\n\t\t\t// 在其他页面中，跳转到详情页，同时传递必要的用户信息\n\t\t\tuni.navigateTo( {\n\t\t\t\turl: `/pages/article/articleDetail?article_id=${id}&user_id=${props.item.user_id}`,\n\t\t\t\tanimationType: 'slide-in-right', // 添加滑入动画\n\t\t\t\tanimationDuration: 300 // 设置动画持续时间为300ms\n\t\t\t} )\n\t\t}\n\t}\n\n\t// 处理点赞\n\tconst handleLove = ( id ) => {\n\t\temit( 'like', id )\n\t}\n\n\t// 处理评论更新\n\tconst handleCommentsUpdate = ( newComments ) => {\n\t\temit( 'update:comments', newComments )\n\t}\n\n\t// 点击详情\n\tconst handleDetail = ( article_id ) => {\n\t\tconsole.log( article_id, '跳转文章详情' )\n\t\tuni.navigateTo( {\n\t\t\turl: `/pages/article/articleDetail?article_id=${article_id}`,\n\t\t\tanimationType: 'slide-in-right', // 添加滑入动画\n\t\t\tanimationDuration: 300 // 设置动画持续时间为300ms\n\t\t} )\n\t}\n\n\t// 跳转到文章详情\n\tconst goToDetail = ( item ) => {\n\t\tif ( !props.showComments ) { // 如果不是在详情页中\n\t\t\t// 防止快速多次点击\n\t\t\tif (isNavigating.value) return;\n\t\t\tisNavigating.value = true;\n\t\t\t\n\t\t\ttry {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: `/pages/article/articleDetail?article_id=${item._id}&user_id=${item.user_id}`,\n\t\t\t\t\tanimationType: 'slide-in-right', // 添加滑入动画\n\t\t\t\t\tanimationDuration: 300, // 设置动画持续时间为300ms\n\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\tconsole.log('跳转到文章详情成功');\n\t\t\t\t\t},\n\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\tconsole.error('跳转到文章详情失败:', err);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 抖音小程序特定错误处理\n\t\t\t\t\t\t// #ifdef MP-TOUTIAO\n\t\t\t\t\t\t// 如果是因为跳转过于频繁导致的错误，可以延迟重试\n\t\t\t\t\t\tif (err.errMsg && err.errMsg.includes('too frequent')) {\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\turl: `/pages/article/articleDetail?article_id=${item._id}&user_id=${item.user_id}`\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '页面跳转失败',\n\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 非抖音小程序环境\n\t\t\t\t\t\t// #ifndef MP-TOUTIAO\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '页面跳转失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// #endif\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\t// 防抖处理，500ms后重置状态\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tisNavigating.value = false;\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('跳转异常:', e);\n\t\t\t\tisNavigating.value = false;\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '操作异常，请重试',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t// 防抖变量\n\tconst isNavigating = ref(false);\n\n\t// 计算用户信息\n\tconst userInfo = computed( ( ) => {\n\t\treturn props.item || {\n\t\t\tnickName: '未知用户',\n\t\t\tavatarUrl: '/static/images/default-avatar.png',\n\t\t\tmobile: '未填写'\n\t\t}\n\t} )\n\n\tconst onAvatarError = ( e ) => {\n\t\te.target.src = '/static/images/default-avatar.png'\n\t}\n\n\tconst handlePreview = (url, index) => {\n\t\tif (!url) return\n\t\tconsole.log('Preview URL:', url)\n\t\t\n\t\t// 获取有效图片列表\n\t\tconst validImages = props.item.images.filter(img => img.thumbnailURL || img.compressedURL || img.url)\n\t\tif (validImages.length) {\n\t\t\t// 图片超过9张时，只预览前8张\n\t\t\tconst maxPreviewImages = validImages.length > 9 ? 8 : 9\n\t\t\t// 提取图片URL列表 - 优先使用compressedURL，最多显示maxPreviewImages张\n\t\t\tconst limitedImages = validImages.slice(0, maxPreviewImages)\n\t\t\tlet urls = limitedImages.map(img => img.compressedURL || img.thumbnailURL || img.url)\n\t\t\t\n\t\t\t// 抖音小程序图片处理\n\t\t\t// #ifdef MP-TOUTIAO\n\t\t\t// 确保所有图片URL都是https\n\t\t\turls = urls.map(imgUrl => {\n\t\t\t\t// 修复协议为https\n\t\t\t\tif (imgUrl && imgUrl.startsWith('http://')) {\n\t\t\t\t\treturn imgUrl.replace('http://', 'https://');\n\t\t\t\t}\n\t\t\t\treturn imgUrl;\n\t\t\t});\n\t\t\t// #endif\n\t\t\t\n\t\t\t// 确保索引不超过限制后的图片数量\n\t\t\tconst previewIndex = Math.min(index, urls.length - 1)\n\t\t\t\n\t\t\t// 使用uni.previewImage实现图片预览和左右滑动功能\n\t\t\tuni.previewImage({\n\t\t\t\turls: urls,           // 需要预览的图片链接列表\n\t\t\t\tcurrent: urls[previewIndex], // 当前显示图片的链接\n\t\t\t\tindicator: 'number',  // 显示页码指示器\n\t\t\t\tloop: true,           // 循环预览\n\t\t\t\t// 抖音小程序特殊处理\n\t\t\t\t// #ifdef MP-TOUTIAO\n\t\t\t\tlongPressActions: {\n\t\t\t\t\titemList: ['保存图片', '分享'],\n\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\tconsole.log('选中了第' + (data.tapIndex + 1) + '个按钮');\n\t\t\t\t\t},\n\t\t\t\t\tfail: function(err) {\n\t\t\t\t\t\tconsole.log(err.errMsg);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// #endif\n\t\t\t\tsuccess: () => {\n\t\t\t\t\tconsole.log('图片预览成功');\n\t\t\t\t},\n\t\t\t\tfail: (err) => {\n\t\t\t\t\tconsole.error('预览图片失败:', err);\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '预览图片失败',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// Add a new function for image preview on long press\n\tconst handleLongPressPreview = (url, index) => {\n\t\tif (!url) return\n\t\tconsole.log('Original URL:', url)\n\t\t\n\t\t// 获取有效图片列表\n\t\tconst validImages = props.item.images.filter(img => img.thumbnailURL || img.compressedURL || img.url)\n\t\tif (validImages.length) {\n\t\t\t// 图片超过9张时，只预览前8张\n\t\t\tconst maxPreviewImages = validImages.length > 9 ? 8 : 9\n\t\t\t// 提取图片URL列表 - 优先使用compressedURL，最多显示maxPreviewImages张\n\t\t\tconst limitedImages = validImages.slice(0, maxPreviewImages)\n\t\t\tlet urls = limitedImages.map(img => img.compressedURL || img.thumbnailURL || img.url)\n\t\t\t\n\t\t\t// 抖音小程序图片处理\n\t\t\t// #ifdef MP-TOUTIAO\n\t\t\t// 确保所有图片URL都是https\n\t\t\turls = urls.map(imgUrl => {\n\t\t\t\t// 修复协议为https\n\t\t\t\tif (imgUrl && imgUrl.startsWith('http://')) {\n\t\t\t\t\treturn imgUrl.replace('http://', 'https://');\n\t\t\t\t}\n\t\t\t\treturn imgUrl;\n\t\t\t});\n\t\t\t// #endif\n\t\t\t\n\t\t\t// 传递所有图片URL到父组件进行预览\n\t\t\t// 确保索引不超过限制后的图片数量\n\t\t\tconst previewIndex = Math.min(index, urls.length - 1)\n\t\t\temit('preview', urls[previewIndex], urls)\n\t\t}\n\t}\n\n\t// 计算当前年份和月份\n\tconst currentDate = computed(() => {\n\t\tconst now = new Date();\n\t\treturn {\n\t\t\tyear: now.getFullYear(),\n\t\t\tmonth: now.getMonth() + 1\n\t\t};\n\t});\n\n\t// 格式化月份为两位数\n\tconst formattedMonth = computed(() => {\n\t\treturn currentDate.value.month < 10 ? `0${currentDate.value.month}` : currentDate.value.month;\n\t});\n</script>\n\n<template>\n\t<view class=\"pyqContent\">\n\t\t<!-- \n\t\t\t抖音小程序适配说明：\n\t\t\t1. 图片事件：使用@longpress替代@longtap\n\t\t\t2. 图片属性：添加show-menu-by-longpress支持长按菜单\n\t\t\t3. 链接处理：确保所有外部链接和图片链接使用https协议\n\t\t\t4. 样式优化：添加will-change和transform:translateZ(0)提升渲染性能\n\t\t\t5. 添加防抖处理：避免快速点击导致的页面跳转问题\n\t\t-->\n\t\t<!-- 动态头部 -->\n\t\t<view class=\"pyq-head\">\n\t\t\t<view class=\"left\" @click=\"handleUserList(item.user_id)\" :class=\"{'disabled': !avatarClickEnabled}\">\n\t\t\t\t<view class=\"user-avatar-container\">\n\t\t\t\t\t<view class=\"userAvatar\">\n\t\t\t\t\t\t<image class=\"avatar-image\" :src=\"userInfo.user_avatarUrl\" mode=\"aspectFill\" @error=\"onAvatarError\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<!-- 添加年份和月份显示 -->\n\t\t\t\t\t<view class=\"date-display\">\n\t\t\t\t\t\t<text class=\"year\">{{currentDate.value.year}}</text>\n\t\t\t\t\t\t<text class=\"month\">{{formattedMonth}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"info\">\n\t\t\t\t\t<view class=\"top\">\n\t\t\t\t\t\t<view class=\"nickName\">\n\t\t\t\t\t\t\t{{userInfo.user_nickName}}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<!-- 审核状态样式 -->\n\t\t\t\t\t\t<view class=\"examine\">\n\t\t\t\t\t\t\t<slot></slot>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"address\">\n\t\t\t\t\t\t<uni-icons custom-prefix=\"icon\" type=\"lishuai-dingwei\" size=\"12\" color=\"#8a8a8a\"></uni-icons>\n\t\t\t\t\t\t<text class=\"address-text\">{{item.district || '未知位置'}}</text>\n\t\t\t\t\t\t<!-- 在地区后面添加时间和浏览次数 -->\n\t\t\t\t\t\t<text class=\"time-text\" v-if=\"item.create_time\">{{ formatDate(item.create_time) }}</text>\n\t\t\t\t\t\t<text class=\"view-count-text\" v-if=\"item.look_count !== undefined\">{{ item.look_count || 0 }}次浏览</text>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 文章的功能操作 -->\n\t\t\t<view class=\"right\">\n\t\t\t\t<view class=\"operation\">\n\t\t\t\t\t<!-- 统一根据用户ID判断显示按钮 -->\n\t\t\t\t\t<view class=\"action-btn\" v-if=\"item.user_id === userStore.userInfo.uid\"\n\t\t\t\t\t\t@click=\"handleDelete(item._id)\">\n\t\t\t\t\t\t<uni-icons color=\"#999999\" custom-prefix=\"icon\" type=\"lishuai-shanchu\" size=\"18\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"action-btn\" v-else @click=\"handleContact(item.user_mobile)\">\n\t\t\t\t\t\t<uni-icons color=\"#5cb85c\" custom-prefix=\"icon\" type=\"lishuai-dianhua\" size=\"18\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t<!-- 动态发布的内容 -->\n\t\t<view class=\"pyq-c\" @click=\"goToDetail(item)\">\n\t\t\t<view class=\"text-content\">{{item.content}}</view>\n\t\t</view>\n\t\t<!-- 动态照片 -->\n\t\t<view class=\"pyq-img\" v-if=\"item.images?.length\">\n\t\t\t<!-- 单张图片显示 -->\n\t\t\t<view class=\"single-img\" v-if=\"item.images.length === 1\">\n\t\t\t\t<image class=\"single-img-item\" :lazy-load=\"true\" :src=\"item.images[0].compressedURL || item.images[0].thumbnailURL || item.images[0].url\" mode=\"widthFix\"\n\t\t\t\t\t@click=\"goToDetail(item)\"\n\t\t\t\t\t@longpress=\"() => handleLongPressPreview(item.images[0].compressedURL || item.images[0].thumbnailURL || item.images[0].url, 0)\"\n\t\t\t\t\tshow-menu-by-longpress></image>\n\t\t\t</view>\n\t\t\t<!-- 多张图片显示 -->\n\t\t\t<view class=\"multi-img\" v-else>\n\t\t\t\t<view :class=\"['img-grid', `grid-${Math.min(item.images.length, 9)}`]\">\n\t\t\t\t\t<!-- 如果超过9张图片，只显示8张+更多按钮；否则显示全部图片 -->\n\t\t\t\t\t<template v-if=\"item.images.length > 9\">\n\t\t\t\t\t\t<image class=\"grid-item\" :lazy-load=\"true\" v-for=\"(img, index) in item.images.slice(0, 8)\" :key=\"index\" :src=\"img.compressedURL || img.thumbnailURL || img.url\"\n\t\t\t\t\t\t\tmode=\"aspectFill\" \n\t\t\t\t\t\t\t@click=\"goToDetail(item)\"\n\t\t\t\t\t\t\t@longpress=\"() => handleLongPressPreview(img.compressedURL || img.thumbnailURL || img.url, index)\"\n\t\t\t\t\t\t\tshow-menu-by-longpress></image>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- 第9个位置显示\"更多\"提示，使用第9张图片作为背景 -->\n\t\t\t\t\t\t<view class=\"grid-item more-images-indicator\" @click=\"goToDetail(item)\">\n\t\t\t\t\t\t\t<image class=\"more-background-image\" :src=\"item.images[8].compressedURL || item.images[8].thumbnailURL || item.images[8].url\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t\t<view class=\"more-overlay\">\n\t\t\t\t\t\t\t\t<text>+{{item.images.length - 8}}</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</template>\n\t\t\t\t\t\n\t\t\t\t\t<!-- 数量小于等于9张时，正常显示 -->\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<image class=\"grid-item\" :lazy-load=\"true\" v-for=\"(img, index) in item.images\" :key=\"index\" :src=\"img.compressedURL || img.thumbnailURL || img.url\"\n\t\t\t\t\t\t\tmode=\"aspectFill\" \n\t\t\t\t\t\t\t@click=\"goToDetail(item)\"\n\t\t\t\t\t\t\t@longpress=\"() => handleLongPressPreview(img.compressedURL || img.thumbnailURL || img.url, index)\"\n\t\t\t\t\t\t\tshow-menu-by-longpress></image>\n\t\t\t\t\t</template>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 动态操作功能 -->\n\t\t<view class=\"pyq-gn\">\n\t\t\t<!-- 左侧区域，可以放置其他内容或保留空白 -->\n\t\t\t<view class=\"left-area\">\n\t\t\t\t<!-- 视频标识图标 -->\n\t\t\t\t<uni-icons v-if=\"item.videoURL || item.video?.videoURL\" custom-prefix=\"icon\" type=\"lishuai-shipin\" size=\"14\" color=\"#999999\"></uni-icons>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 右侧功能区 - 时间和浏览量一起显示 -->\n\t\t\t<view class=\"right\">\n\t\t\t\t<!-- 发布时间 -->\n\t\t\t\t<view class=\"publicTime time-info\">\n\t\t\t\t\t{{ formatDate(item.create_time) }}\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 浏览次数 -->\n\t\t\t\t<view class=\"publicTime view-info\">\n\t\t\t\t\t{{ item.look_count || 0 }}次浏览\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<style lang=\"scss\" scoped>\n\t/*朋友圈动态*/\n\t.pyqContent {\n\t\tflex: 1;\n\t\tmargin-bottom: 2rpx;\n\t\tpadding: 24rpx;\n\t\tbackground-color: #fff;\n\n\t\t/* 显示详情按钮 */\n\t\t.detail-btn {\n\t\t\tpadding: 8rpx 20rpx;\n\t\t\tbackground-color: #1890ff;\n\t\t\tcolor: #ffffff;\n\t\t\tborder-radius: 8rpx;\n\t\t\tfont-size: 24rpx;\n\t\t}\n\t\t\n\t\t/*头部-用户基本信息*/\n\t\t.pyq-head {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\n\t\t\t/*左侧用户信息*/\n\t\t\t.left {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\n\t\t\t\t&.disabled {\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t\topacity: 0.9;\n\t\t\t\t}\n\n\t\t\t\t/*头像*/\n\t\t\t\t.userAvatar {\n\t\t\t\t\twidth: 80rpx;\n\t\t\t\t\theight: 80rpx;\n\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\n\t\t\t\t\t.avatar-image {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.info {\n\t\t\t\t\tmargin: 0 16rpx;\n\n\t\t\t\t\t.top {\n\t\t\t\t\t\tdisplay: flex;\n\n\t\t\t\t\t\t/*昵称*/\n\t\t\t\t\t\t.nickName {\n\t\t\t\t\t\t\t@include gradientText;\n\t\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/*审核样式*/\n\t\t\t\t\t\t.examine {\n\t\t\t\t\t\t\tmargin-left: 16rpx;\n\t\t\t\t\t\t\tcolor: #fa8c16;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t/*定位*/\n\t\t\t\t\t.address {\n\t\t\t\t\t\tfont-size: 28rpx;\n\t\t\t\t\t\tcolor: $pyq-text-color-helper;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tflex-wrap: wrap; /* 小屏幕上允许换行 */\n\t\t\t\t\t\tmargin-top: 4rpx; /* 添加顶部间距 */\n\t\t\t\t\t\t\n\t\t\t\t\t\t.address-text {\n\t\t\t\t\t\t\tmargin-left: 4rpx;\n\t\t\t\t\t\t\tmargin-right: 8rpx; /* 右侧添加间距 */\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t/* 时间文本样式 */\n\t\t\t\t\t\t.time-text {\n\t\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\t\t\tposition: relative; /* 用于定位分隔符 */\n\t\t\t\t\t\t\tpadding-left: 12rpx; /* 为分隔符留出空间 */\n\t\t\t\t\t\t\tmargin-right: 8rpx; /* 右侧添加间距 */\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t/* 使用伪元素添加分隔符 */\n\t\t\t\t\t\t\t&:before {\n\t\t\t\t\t\t\t\tcontent: '|';\n\t\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t\t\tcolor: #ddd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t/* 浏览次数文本样式 */\n\t\t\t\t\t\t.view-count-text {\n\t\t\t\t\t\t\tcolor: #999;\n\t\t\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\t\t\tposition: relative; /* 用于定位分隔符 */\n\t\t\t\t\t\t\tpadding-left: 12rpx; /* 为分隔符留出空间 */\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t/* 使用伪元素添加分隔符 */\n\t\t\t\t\t\t\t&:before {\n\t\t\t\t\t\t\t\tcontent: '|';\n\t\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t\t\tcolor: #ddd;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*顶部右侧功能*/\n\t\t\t.right {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\n\t\t\t\t.operation {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\n\t\t\t\t\t.action-btn {\n\t\t\t\t\t\tpadding: 20rpx;\n\t\t\t\t\t\tcursor: pointer;\n\n\t\t\t\t\t\t&:active {\n\t\t\t\t\t\t\topacity: 0.7;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/*内容-发布文字内容*/\n\t\t.pyq-c {\n\t\t\tmargin-left: 96rpx;\n\t\t\tfont-size: 32rpx;\n\t\t\tcolor: $pyq-text-color-body;\n\t\t\tcursor: pointer;\n\n\t\t\t&:active {\n\t\t\t\topacity: 0.7;\n\t\t\t}\n\t\t}\n\n\t\t/*文字内容*/\n\t\t.text-content {\n\t\t\t@include textShenglue(5);\n\t\t\tmargin-bottom: 16rpx;\n\t\t}\n\n\t\t/*发布的图片*/\n\t\t.pyq-img {\n\t\t\tmargin-left: 96rpx;\n\n\t\t\t// 单张图片样式\n\t\t\t.single-img {\n\t\t\t\twidth: 300rpx;\n\t\t\t\tmin-height: 100rpx;\n\t\t\t\tmax-height: 600rpx;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t\toverflow: hidden;\n\t\t\t\t/* 抖音小程序兼容性优化 */\n\t\t\t\tposition: relative;\n\t\t\t\tfont-size: 0;\n\n\t\t\t\t.single-img-item {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: auto;\n\t\t\t\t\tvertical-align: top;\n\t\t\t\t\t/* 抖音小程序图片优化 */\n\t\t\t\t\twill-change: transform;\n\t\t\t\t\ttransform: translateZ(0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// 多张图片样式\n\t\t\t.multi-img {\n\t\t\t\twidth: 100%; // 确保容器宽度占满父元素\n\t\t\t\t\n\t\t\t\t.img-grid {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmax-width: 630rpx; // 设置最大宽度，防止在大屏上过宽\n\t\t\t\t\t\n\t\t\t\t\t// 使用统一间距\n\t\t\t\t\tmargin: -5rpx;\n\t\t\t\t\tpadding: 5rpx;\n\n\t\t\t\t\t.grid-item {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\twidth: calc(33.333% - 10rpx); // 3等分减去间距\n\t\t\t\t\t\theight: 180rpx; // 恢复固定高度\n\t\t\t\t\t\tmargin: 5rpx;\n\t\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t\n\t\t\t\t\t\t/* 抖音小程序图片优化 */\n\t\t\t\t\t\twill-change: transform;\n\t\t\t\t\t\ttransform: translateZ(0);\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 更多图片指示器样式\n\t\t\t\t\t.more-images-indicator {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\twidth: calc(33.333% - 10rpx); // 与普通图片保持一致的宽度\n\t\t\t\t\t\theight: 180rpx; // 恢复固定高度\n\t\t\t\t\t\tmargin: 5rpx;\n\t\t\t\t\t\tborder-radius: 8rpx;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 抖音小程序兼容性优化\n\t\t\t\t\t\tz-index: 1;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 背景图片样式\n\t\t\t\t\t\t.more-background-image {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t\ttop: 0;\n\t\t\t\t\t\t\tz-index: 1;\n\t\t\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 半透明遮罩层\n\t\t\t\t\t\t.more-overlay {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tleft: 0;\n\t\t\t\t\t\t\ttop: 0;\n\t\t\t\t\t\t\tbackground-color: rgba(0, 0, 0, 0.5);\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\t\tz-index: 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\ttext {\n\t\t\t\t\t\t\t// 确保文字在抖音小程序中正确显示\n\t\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\t\tz-index: 3;\n\t\t\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\t\t\tcolor: #fff;\n\t\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 特殊处理特定数量的图片\n\t\t\t\t\t&.grid-1 {\n\t\t\t\t\t\t// 单图样式特殊处理\n\t\t\t\t\t\t.grid-item {\n\t\t\t\t\t\t\twidth: 300rpx; // 单图固定宽度\n\t\t\t\t\t\t\theight: 300rpx; // 单图固定高度\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// 4张图片特殊处理 - 2x2布局\n\t\t\t\t\t&.grid-4 {\n\t\t\t\t\t\tmax-width: 420rpx; // 4张图特殊宽度\n\t\t\t\t\t\t\n\t\t\t\t\t\t.grid-item {\n\t\t\t\t\t\t\twidth: calc(50% - 10rpx); // 二等分宽度减去间隙\n\t\t\t\t\t\t\theight: 180rpx; // 保持固定高度\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 5-9张图片使用3x3网格布局\n\t\t\t\t\t&.grid-5, &.grid-6, &.grid-7, &.grid-8, &.grid-9 {\n\t\t\t\t\t\t/* 抖音小程序网格布局优化 */\n\t\t\t\t\t\tmax-width: 630rpx;\n\t\t\t\t\t\t\n\t\t\t\t\t\t.grid-item {\n\t\t\t\t\t\t\twidth: calc(33.333% - 10rpx);\n\t\t\t\t\t\t\theight: 180rpx; // 保持固定高度\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/*朋友圈动态操作功能区*/\n\t\t.pyq-gn {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\talign-items: center;\n\t\t\tmargin-top: 24rpx;\n\t\t\tpadding-left: 96rpx;\n\n\t\t\t/*左侧区域，可以放置其他内容或保留空白 */\n\t\t\t.left-area {\n\t\t\t\t// 视频标识图标\n\t\t\t\t.uni-icons {\n\t\t\t\t\tmargin-right: 8rpx;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttop: 2rpx;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*右侧功能区 - 时间和浏览量一起显示 */\n\t\t\t.right {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\n\t\t\t\t/*发布时间*/\n\t\t\t\t.publicTime {\n\t\t\t\t\tfont-size: 24rpx;\n\t\t\t\t\tcolor: $pyq-text-color-placeholder;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* 分隔符 */\n\t\t\t\t.time-info:after {\n\t\t\t\t\tcontent: '|';\n\t\t\t\t\tmargin: 0 10rpx;\n\t\t\t\t\tcolor: #ddd;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n</style>","import Component from 'E:/dy2/components/articleItem/articleItem.vue'\ntt.createComponent(Component)"]}