# é“¾ç§‘äº‘æ‰“å°å°ç¨‹åºåŠŸèƒ½å®Œå–„è¯´æ˜

## ğŸ“‹ æ›´æ–°å†…å®¹

### 1. API é…ç½®æ›´æ–°

**æ–‡ä»¶ï¼š** `utils/printApi.js`

#### æ›´æ–°å†…å®¹ï¼š
- âœ… æ›´æ–°è®¾å¤‡ä¿¡æ¯ä¸ºå®é™…æµ‹è¯•çš„æ‰“å°æœºå‚æ•°
  - è®¾å¤‡ID: `lc01cc05708199`
  - è®¾å¤‡å¯†ç : `XnoyolfCxRRxQThh`
  - æ‰“å°æœºå‹å·: `Canon G5080 series`
  - USBç«¯å£: `USB 1`
  - é©±åŠ¨åç§°: `Canon G5080 series`

- âœ… æ·»åŠ  V3 API æ”¯æŒ
  - `submitPrintTask()` - æäº¤æ‰“å°ä»»åŠ¡ï¼ˆæ”¯æŒæ–‡ä»¶å’ŒURLï¼‰
  - `queryTaskStatus()` - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
  - `cancelTask()` - å–æ¶ˆä»»åŠ¡

- âœ… å®Œå–„æ‰“å°å‚æ•°æ”¯æŒ
  - `dmPaperSize` - çº¸å¼ å°ºå¯¸ï¼ˆA4=9, A5=11, Letter=1, A3=8ï¼‰
  - `dmOrientation` - æ‰“å°æ–¹å‘ï¼ˆç«–å‘=1, æ¨ªå‘=2ï¼‰
  - `dmColor` - é¢œè‰²æ¨¡å¼ï¼ˆé»‘ç™½=1, å½©è‰²=2ï¼‰
  - `dmDuplex` - åŒé¢æ‰“å°ï¼ˆå…³é—­=1, é•¿è¾¹=2, çŸ­è¾¹=3ï¼‰
  - `dmCopies` - æ‰“å°ä»½æ•°
  - `isPreview` - æ˜¯å¦ç”Ÿæˆé¢„è§ˆå›¾ï¼ˆå¦=0, æ˜¯=1ï¼‰

- âœ… æ”¯æŒä¸¤ç§æ–‡ä»¶è¾“å…¥æ–¹å¼
  - æœ¬åœ°æ–‡ä»¶ä¸Šä¼ ï¼ˆ`jobFile`ï¼‰
  - æ–‡ä»¶URLåœ°å€ï¼ˆ`jobFileUrl`ï¼‰

---

### 2. æµ‹è¯•é¡µé¢å¢å¼º

**æ–‡ä»¶ï¼š** `pages/test/test.vue`

#### æ–°å¢åŠŸèƒ½ï¼š

##### ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢å¡ç‰‡
```vue
<!-- æ˜¾ç¤ºä»»åŠ¡ID -->
<view class="info-row">
  <text class="label">ä»»åŠ¡IDï¼š</text>
  <text class="value task-id">{{ currentTaskId }}</text>
</view>

<!-- æ“ä½œæŒ‰é’® -->
<button class="query-btn" @click="queryTask">æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€</button>
<button class="cancel-btn" @click="cancelTask">å–æ¶ˆä»»åŠ¡</button>
<button class="preview-btn" @click="openPreview">æ‰“å¼€é¢„è§ˆå›¾</button>

<!-- ä»»åŠ¡ä¿¡æ¯ -->
<view class="task-info">
  <text>ä»»åŠ¡çŠ¶æ€ï¼š{{ taskInfo.task_state }}</text>
  <text>å®Œæˆæ—¶é—´ï¼š{{ taskInfo.task_done_time }}</text>
</view>
```

##### æ–°å¢æ–¹æ³•ï¼š

**1. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€**
```javascript
async queryTask() {
  const result = await printApi.queryTaskStatus(this.currentTaskId);
  this.taskInfo = result.data;
  // æ£€æŸ¥é¢„è§ˆå›¾
  if (result.data.task_result?.data?.img_list) {
    this.previewImageUrl = result.data.task_result.data.img_list[0];
  }
}
```

**2. å–æ¶ˆä»»åŠ¡**
```javascript
async cancelTask() {
  await printApi.cancelTask(this.currentTaskId);
}
```

**3. æ‰“å¼€é¢„è§ˆå›¾**
```javascript
openPreview() {
  uni.previewImage({
    urls: [this.previewImageUrl],
    current: 0
  });
}
```

**4. è·å–çŠ¶æ€æ ·å¼**
```javascript
getStatusClass(status) {
  if (status === 'SUCCESS') return 'status-success';
  if (status === 'FAILED' || status === 'ERROR') return 'status-error';
  if (status === 'PENDING' || status === 'PROCESSING') return 'status-processing';
  return '';
}
```

#### æµ‹è¯•æµç¨‹æ›´æ–°ï¼š

æ­¥éª¤3ç°åœ¨ä½¿ç”¨ V3 APIï¼š
```javascript
const printResult = await printApi.submitPrintTask({
  deviceId: this.deviceInfo.id,
  devicePassword: this.deviceInfo.password,
  printerName: this.deviceInfo.model,
  driverName: this.deviceInfo.driverName,
  jobFileUrl: 'https://example.com/test.pdf', // æ–‡ä»¶URL
  dmPaperSize: 9, // A4
  dmOrientation: 1, // ç«–å‘
  dmColor: 1, // é»‘ç™½
  dmDuplex: 1, // å…³é—­åŒé¢
  dmCopies: 1, // 1ä»½
  isPreview: 1 // ç”Ÿæˆé¢„è§ˆå›¾
});

// ä¿å­˜ä»»åŠ¡ID
this.currentTaskId = printResult.data.task_id;
```

---

### 3. æ‰“å°é¡µé¢å®Œå–„

**æ–‡ä»¶ï¼š** `pages/print/print.vue`

#### æ–°å¢åŠŸèƒ½ï¼š

##### æ–‡æ¡£è¾“å…¥æ–¹å¼åˆ‡æ¢
```vue
<view class="input-type-btns">
  <button :class="{'active': inputType === 'file'}" 
          @click="inputType = 'file'">
    æœ¬åœ°æ–‡ä»¶
  </button>
  <button :class="{'active': inputType === 'url'}" 
          @click="inputType = 'url'">
    æ–‡ä»¶URL
  </button>
</view>

<!-- æœ¬åœ°æ–‡ä»¶ä¸Šä¼  -->
<view v-if="inputType === 'file'">
  <button @click="chooseFile">é€‰æ‹©æ–‡ä»¶</button>
</view>

<!-- URLè¾“å…¥ -->
<view v-if="inputType === 'url'">
  <textarea v-model="fileUrl" 
            placeholder="è¯·è¾“å…¥æ–‡ä»¶çš„å®Œæ•´URLåœ°å€"></textarea>
</view>
```

##### å®Œæ•´çš„æ‰“å°å‚æ•°è®¾ç½®

**çº¸å¼ å°ºå¯¸é€‰æ‹©ï¼š**
```javascript
paperSizes: [
  { name: 'A4', value: 9 },
  { name: 'A5', value: 11 },
  { name: 'Letter', value: 1 },
  { name: 'A3', value: 8 }
]
```

**æ‰“å°æ–¹å‘ï¼š**
```vue
<button :class="{'active': orientation === 1}" 
        @click="orientation = 1">
  ç«–å‘
</button>
<button :class="{'active': orientation === 2}" 
        @click="orientation = 2">
  æ¨ªå‘
</button>
```

**é¢œè‰²æ¨¡å¼ï¼š**
```vue
<button :class="{'active': colorMode === 2}" 
        @click="colorMode = 2">
  å½©è‰²
</button>
<button :class="{'active': colorMode === 1}" 
        @click="colorMode = 1">
  é»‘ç™½
</button>
```

**åŒé¢æ‰“å°ï¼š**
```vue
<button :class="{'active': duplexMode === 1}" 
        @click="duplexMode = 1">
  å…³é—­
</button>
<button :class="{'active': duplexMode === 3}" 
        @click="duplexMode = 3">
  çŸ­è¾¹
</button>
<button :class="{'active': duplexMode === 2}" 
        @click="duplexMode = 2">
  é•¿è¾¹
</button>
```

#### æ‰“å°æ–¹æ³•æ›´æ–°ï¼š

```javascript
async startPrint() {
  // æ„å»ºé€šç”¨æ‰“å°å‚æ•°
  const printData = {
    deviceId: this.currentPrinter.id,
    devicePassword: this.currentPrinter.password,
    printerName: this.currentPrinter.model,
    driverName: this.currentPrinter.driverName,
    dmCopies: this.copies,
    dmPaperSize: this.currentPaperSize.value,
    dmOrientation: this.orientation,
    dmColor: this.colorMode,
    dmDuplex: this.duplexMode,
    isPreview: 1
  };
  
  // æ ¹æ®è¾“å…¥ç±»å‹è°ƒç”¨API
  if (this.inputType === 'url') {
    result = await printApi.submitPrintTask({
      ...printData,
      jobFileUrl: this.fileUrl
    });
  } else {
    // å…ˆä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨URL
    const uploadResult = await printApi.uploadFile(file.path);
    result = await printApi.submitPrintTask({
      ...printData,
      jobFileUrl: uploadResult.data.url
    });
  }
  
  // æ˜¾ç¤ºä»»åŠ¡ID
  const taskId = result.data?.task_id;
  uni.showModal({
    title: 'æ‰“å°ä»»åŠ¡å·²æäº¤',
    content: `ä»»åŠ¡ID: ${taskId}\n\nå¯åœ¨å†å²è®°å½•ä¸­æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€`
  });
}
```

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. æµ‹è¯•æ‰“å°åŠŸèƒ½

1. æ‰“å¼€å°ç¨‹åºï¼Œè¿›å…¥ã€Œæµ‹è¯•ã€é¡µé¢
2. ç‚¹å‡»ã€Œå¼€å§‹æµ‹è¯•ã€æŒ‰é’®
3. ç­‰å¾…æµ‹è¯•å®Œæˆï¼Œè®°å½•ä»»åŠ¡ID
4. ç‚¹å‡»ã€ŒæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ã€æŸ¥çœ‹æ‰“å°è¿›åº¦
5. ä»»åŠ¡å®Œæˆåï¼Œç‚¹å‡»ã€Œæ‰“å¼€é¢„è§ˆå›¾ã€æŸ¥çœ‹æ‰“å°é¢„è§ˆ

### 2. æ–‡æ¡£æ‰“å°ï¼ˆURLæ–¹å¼ï¼‰

1. è¿›å…¥ã€Œæ‰“å°ã€é¡µé¢
2. é€‰æ‹©ã€Œæ–‡æ¡£ã€ç±»å‹
3. é€‰æ‹©ã€Œæ–‡ä»¶URLã€è¾“å…¥æ–¹å¼
4. è¾“å…¥æ–‡ä»¶URLï¼ˆä¾‹å¦‚ï¼š`https://example.com/document.pdf`ï¼‰
5. è®¾ç½®æ‰“å°å‚æ•°ï¼š
   - çº¸å¼ å¤§å°ï¼šA4
   - æ‰“å°æ–¹å‘ï¼šç«–å‘
   - é¢œè‰²æ¨¡å¼ï¼šé»‘ç™½
   - åŒé¢æ‰“å°ï¼šå…³é—­
   - æ‰“å°ä»½æ•°ï¼š1
6. ç‚¹å‡»ã€Œå¼€å§‹æ‰“å°ã€
7. è®°å½•ä»»åŠ¡IDï¼Œå¯åœ¨å†å²è®°å½•ä¸­æŸ¥è¯¢çŠ¶æ€

### 3. æ–‡æ¡£æ‰“å°ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰

1. è¿›å…¥ã€Œæ‰“å°ã€é¡µé¢
2. é€‰æ‹©ã€Œæ–‡æ¡£ã€ç±»å‹
3. é€‰æ‹©ã€Œæœ¬åœ°æ–‡ä»¶ã€è¾“å…¥æ–¹å¼
4. ç‚¹å‡»ã€Œé€‰æ‹©æ–‡ä»¶ã€ï¼Œé€‰æ‹©è¦æ‰“å°çš„æ–‡ä»¶
5. è®¾ç½®æ‰“å°å‚æ•°
6. ç‚¹å‡»ã€Œå¼€å§‹æ‰“å°ã€
7. ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸Šä¼ æ–‡ä»¶å¹¶æäº¤æ‰“å°ä»»åŠ¡

---

## ğŸ“Š API å‚æ•°å¯¹ç…§è¡¨

### çº¸å¼ å°ºå¯¸ (dmPaperSize)
| åç§° | å€¼ |
|------|-----|
| Letter | 1 |
| A3 | 8 |
| A4 | 9 |
| A5 | 11 |

### æ‰“å°æ–¹å‘ (dmOrientation)
| åç§° | å€¼ |
|------|-----|
| ç«–å‘ | 1 |
| æ¨ªå‘ | 2 |

### é¢œè‰²æ¨¡å¼ (dmColor)
| åç§° | å€¼ |
|------|-----|
| é»‘ç™½ | 1 |
| å½©è‰² | 2 |

### åŒé¢æ‰“å° (dmDuplex)
| åç§° | å€¼ |
|------|-----|
| å…³é—­ | 1 |
| é•¿è¾¹ | 2 |
| çŸ­è¾¹ | 3 |

### é¢„è§ˆé€‰é¡¹ (isPreview)
| åç§° | å€¼ |
|------|-----|
| å¦ | 0 |
| æ˜¯ | 1 |

---

## ğŸ” ä»»åŠ¡çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | æè¿° | æ ·å¼ç±» |
|------|------|--------|
| PENDING | å¾…å¤„ç† | status-processing |
| PROCESSING | å¤„ç†ä¸­ | status-processing |
| SUCCESS | æˆåŠŸ | status-success |
| FAILED | å¤±è´¥ | status-error |
| ERROR | é”™è¯¯ | status-error |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶URLè¦æ±‚**
   - å¿…é¡»æ˜¯å…¬å¼€å¯è®¿é—®çš„URL
   - æ”¯æŒ PDFã€Office æ–‡æ¡£ç­‰æ ¼å¼
   - ç¡®ä¿æ–‡ä»¶æœåŠ¡å™¨å…è®¸è·¨åŸŸè®¿é—®

2. **æ‰“å°å‚æ•°é™åˆ¶**
   - æ‰“å°ä»½æ•°ï¼š1-99ä»½
   - æ–‡ä»¶å¤§å°ï¼šå»ºè®®ä¸è¶…è¿‡50MB
   - é¢„è§ˆå›¾ï¼šä»…åœ¨ isPreview=1 æ—¶ç”Ÿæˆ

3. **ä»»åŠ¡æŸ¥è¯¢**
   - ä»»åŠ¡IDåœ¨æäº¤åç«‹å³è¿”å›
   - å¯ä»¥å¤šæ¬¡æŸ¥è¯¢åŒä¸€ä»»åŠ¡çŠ¶æ€
   - é¢„è§ˆå›¾åœ¨ä»»åŠ¡å®Œæˆåç”Ÿæˆ

4. **è®¾å¤‡ä¿¡æ¯**
   - ç¡®ä¿è®¾å¤‡IDå’Œå¯†ç æ­£ç¡®
   - æ‰“å°æœºå‹å·å’Œé©±åŠ¨åç§°è¦åŒ¹é…
   - USBç«¯å£å·æ ¹æ®å®é™…è¿æ¥ç¡®å®š

---

## ğŸ“ å†å²è®°å½•å¢å¼º

æ‰“å°å†å²ç°åœ¨åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š

```javascript
{
  id: 'task_id',
  type: 'document',
  printer: 'Canon G5080 series',
  time: '2026-01-15T10:56:07Z',
  status: 'pending',
  params: {
    copies: 1,
    paperSize: 'A4',
    orientation: 'ç«–å‘',
    colorMode: 'é»‘ç™½',
    duplexMode: 'å…³é—­'
  }
}
```

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. âœ¨ æ·»åŠ æ‰¹é‡æ‰“å°åŠŸèƒ½
2. ğŸ“± æ”¯æŒæ‰“å°æ¨¡æ¿ç®¡ç†
3. ğŸ”” æ·»åŠ æ‰“å°å®Œæˆé€šçŸ¥
4. ğŸ“Š æ‰“å°ç»Ÿè®¡æŠ¥è¡¨
5. ğŸ¨ é¢„è§ˆå›¾ç¼–è¾‘åŠŸèƒ½
6. ğŸ’¾ å¸¸ç”¨è®¾ç½®ä¿å­˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- é“¾ç§‘äº‘æ‰“å°å®˜ç½‘ï¼šhttps://liankenet.com
- APIæ–‡æ¡£ï¼šhttps://cloud.liankenet.com/api/docs
- è®¾å¤‡ç®¡ç†ï¼šhttps://open.liankenet.com

---

**æ›´æ–°æ—¥æœŸï¼š** 2026-01-15  
**ç‰ˆæœ¬ï¼š** v1.1.0  
**ä½œè€…ï¼š** Qoder AI Assistant
