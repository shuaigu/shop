# 打印功能验证清单

## 📋 完成此清单以确保打印功能正常工作

### ✅ 第一步：环境准备

- [ ] 已安装微信开发者工具
- [ ] 已导入项目到开发者工具
- [ ] 已配置合法域名（`https://cloud.liankenet.com`）
- [ ] 已开启「不校验合法域名」选项（开发阶段）

### ✅ 第二步：打印机配置

#### 方式一：使用快速填充（推荐）

- [ ] 打开小程序首页
- [ ] 点击「当前打印机」卡片
- [ ] 点击「+ 添加打印机」
- [ ] 点击「⚡ 快速填充测试设备」
- [ ] 确认信息正确：
  - [ ] 设备ID: `lc01cc05708199`
  - [ ] 密码: 已填充（前4位显示）
  - [ ] 型号: `LP-N110W_D2`
  - [ ] 驱动名称: `LP-N110W_D2`
- [ ] 点击「确定」
- [ ] 看到「添加成功」提示

#### 方式二：检查已有打印机

- [ ] 查看打印机列表
- [ ] 确认打印机包含以下字段：
  - [ ] `id`（设备ID）
  - [ ] `password`（不是secret）
  - [ ] `model`（型号）
  - [ ] `driverName`（驱动名称）
- [ ] 如果缺少字段，删除后重新添加

### ✅ 第三步：连接测试

- [ ] 返回首页
- [ ] 点击「🔌 连接测试」按钮
- [ ] 点击「🚀 开始测试」
- [ ] 等待测试完成

#### 验证日志输出

- [ ] **步骤1** - 验证设备信息
  - [ ] 看到「✓ 设备ID: lc01cc05708199」
  - [ ] 看到「✓ 设备密码: Xnoy****」
  - [ ] 看到「✓ 设备验证通过」

- [ ] **步骤2** - 连接打印机
  - [ ] 看到「正在检查打印机状态...」
  - [ ] 看到「✓ 打印机连接成功」或「⚠ 状态检查失败，继续测试」

- [ ] **步骤3** - 测试打印
  - [ ] 看到「准备打印内容」
  - [ ] 看到「✓ 打印任务已提交」
  - [ ] 看到「✓ 任务ID: xxxxx」（记录此ID）
  - [ ] 看到「✓ 测试打印完成」

- [ ] 最终状态显示「已连接」（绿色）

### ✅ 第四步：任务状态查询

- [ ] 在测试页面找到「任务状态查询」卡片
- [ ] 确认显示任务ID
- [ ] 点击「查询任务状态」按钮
- [ ] 等待查询完成

#### 验证查询结果

- [ ] 看到任务状态（PENDING/PROCESSING/SUCCESS）
- [ ] 状态显示正确颜色：
  - PENDING/PROCESSING: 黄色
  - SUCCESS: 绿色
  - FAILED/ERROR: 红色
- [ ] 如果状态为SUCCESS：
  - [ ] 看到完成时间
  - [ ] 看到「打开预览图」按钮
  - [ ] 点击按钮可正常查看预览图

### ✅ 第五步：获取打印机列表

- [ ] 在测试页面点击「🖨️ 获取打印机列表」
- [ ] 等待请求完成
- [ ] 查看日志输出

#### 验证输出

- [ ] 看到「✓ 获取成功，共找到 X 台打印机」
- [ ] 看到打印机详细信息：
  - [ ] 打印机名称
  - [ ] 驱动名称
  - [ ] 端口信息
- [ ] 确认目标打印机在列表中

### ✅ 第六步：文档打印测试

- [ ] 进入「打印」页面
- [ ] 选择「文档」类型
- [ ] 选择「文件URL」方式
- [ ] 输入测试URL：
  ```
  https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf
  ```
- [ ] 确认打印机已选择
- [ ] 设置打印参数：
  - [ ] 纸张大小: A4
  - [ ] 打印方向: 竖向
  - [ ] 颜色: 黑白
  - [ ] 双面: 关闭
  - [ ] 份数: 1
- [ ] 点击「开始打印」

#### 验证打印结果

- [ ] 看到「正在打印...」加载提示
- [ ] 看到「打印任务已提交」对话框
- [ ] 记录任务ID
- [ ] 选择「查看历史」或「继续打印」

### ✅ 第七步：查看历史记录

- [ ] 进入「历史」页面
- [ ] 看到最新的打印记录
- [ ] 记录信息完整：
  - [ ] 打印类型正确
  - [ ] 打印机名称正确
  - [ ] 时间正确
  - [ ] 状态显示正确
  - [ ] 参数信息完整

### ✅ 第八步：开发者工具检查

打开微信开发者工具的Console标签，查看日志：

#### 验证API请求

- [ ] 看到「API请求(Token):」日志
- [ ] 请求URL正确：`https://cloud.liankenet.com/v3/print/submitTask`
- [ ] 请求头包含：
  - [ ] `Content-Type: application/json`
  - [ ] `Authorization: Basic xxxxx`

#### 验证请求数据

- [ ] 看到「打印参数:」日志
- [ ] 参数包含所有必需字段：
  ```javascript
  {
    deviceId: "lc01cc05708199",
    devicePassword: "XnoyolfCxRRxQThh",
    printerName: "LP-N110W_D2",
    driverName: "LP-N110W_D2",
    dmPaperSize: 9,
    dmOrientation: 1,
    dmColor: 1,
    dmDuplex: 1,
    dmCopies: 1,
    isPreview: 1,
    jobFileUrl: "https://..."
  }
  ```
- [ ] 所有字段都有值（不是undefined或null）

#### 验证API响应

- [ ] 看到「API响应:」日志
- [ ] 响应状态码: 200
- [ ] 响应数据包含：
  - [ ] `code: 200` 或 `code: 0`
  - [ ] `data.task_id`（任务ID）

### ✅ 第九步：错误处理测试

#### 测试缺少密码的情况

- [ ] 手动编辑打印机（删除password字段）
- [ ] 尝试打印
- [ ] 看到提示：「打印机缺少密码配置，是否继续？」
- [ ] 点击取消
- [ ] 重新添加打印机

#### 测试错误URL

- [ ] 使用无效URL打印
- [ ] 看到合适的错误提示
- [ ] 错误不会导致程序崩溃

### ✅ 第十步：完整流程测试

从头到尾完整走一遍：

1. [ ] 打开小程序
2. [ ] 首次启动自动添加默认设备
3. [ ] 点击连接测试，测试成功
4. [ ] 提交一个打印任务
5. [ ] 查询任务状态
6. [ ] 查看预览图
7. [ ] 在历史记录中找到任务
8. [ ] 所有步骤都成功完成

## 🎉 验证结果

### ✅ 全部通过

恭喜！打印功能已完全正常。您可以：
- 开始正式使用
- 配置生产环境
- 部署到线上

### ⚠️ 部分失败

如果有步骤失败：

1. **检查配置**
   - 确认设备信息正确
   - 确认网络连接正常
   - 确认打印机在线

2. **查看日志**
   - 打开开发者工具Console
   - 查找错误信息
   - 记录错误详情

3. **参考文档**
   - 查看「使用指南.md」
   - 查看「更新说明-2026-01-27.md」
   - 查看「README.md」常见问题

4. **重新配置**
   - 删除所有打印机
   - 清空本地存储
   - 重新添加打印机
   - 重新测试

## 📞 需要帮助？

如果问题仍未解决，请：

1. 记录失败的步骤编号
2. 截图错误信息
3. 复制Console日志
4. 准备以下信息：
   - 设备ID（脱敏）
   - 任务ID（如有）
   - 操作步骤
   - 错误提示

然后：
- 查看「使用指南.md」的技术支持章节
- 联系链科云技术支持
- 发送邮件到：support@liankenet.com

## 🔧 调试技巧

### 查看本地存储

在开发者工具Console执行：

```javascript
// 查看打印机列表
console.log('打印机列表:', uni.getStorageSync('printers'))

// 查看当前选中的打印机
console.log('当前打印机:', uni.getStorageSync('selectedPrinter'))

// 查看打印历史
console.log('打印历史:', uni.getStorageSync('printHistory'))
```

### 清空本地存储

```javascript
// 清空所有存储
uni.clearStorageSync()

// 单独清空
uni.removeStorageSync('printers')
uni.removeStorageSync('selectedPrinter')
uni.removeStorageSync('printHistory')
```

### 测试API调用

```javascript
// 在Console中测试
const printApi = require('@/utils/printApi.js').default

// 获取默认设备
console.log(printApi.getDefaultDevice())

// 获取Token
console.log(printApi.getDeviceToken())

// 获取Web管理URL
console.log(printApi.getPrintManageUrl())
```

---

**版本**: v1.2.0  
**日期**: 2026-01-27  
**作者**: Qoder AI Assistant

祝您测试顺利！🚀
